{
  "spec": {
    "title": "Writing Assistance APIs",
    "url": "https://webmachinelearning.github.io/writing-assistance-apis/"
  },
  "algorithms": [
    {
      "name": "initialize as a destroyable",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-as-a-destroyable",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-as-a-destroyable\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize as a destroyable</dfn> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable①\">AIDestroyable</a></code> object <var>destroyable</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>controller</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new①\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortcontroller\" id=\"ref-for-abortcontroller①\">AbortController</a></code> created in <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>controller</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal\">signal</a> to a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new②\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal②\">AbortSignal</a></code> created in <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Set <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destruction-abort-controller\" id=\"ref-for-aidestroyable-destruction-abort-controller①\">destruction abort controller</a> to <var>controller</var>.</p>"
        }
      ]
    },
    {
      "name": "AIDestroyable/destroy",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destroy",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"AIDestroyable\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"aidestroyable-destroy\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">destroy</dfn> an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable②\">AIDestroyable</a></code> <var>destroyable</var>, given a JavaScript value <var>reason</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal-abort\" id=\"ref-for-abortcontroller-signal-abort\">Signal abort</a> given <var>destroyable</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destruction-abort-controller\" id=\"ref-for-aidestroyable-destruction-abort-controller②\">destruction abort controller</a> and <var>reason</var>.</p>"
        },
        {
          "html": "<p>The user agent should release any resources associated with <var>destroyable</var>, such as AI models loaded to support its operation, as long as those resources are not needed for other ongoing operations.</p>"
        }
      ]
    },
    {
      "name": "AISummarizerFactory/create(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizerfactory-create",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizerFactory\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"create(options)|create()\" id=\"dom-aisummarizerfactory-create\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>create(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with①\">a promise rejected with</a> <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-signal\" id=\"ref-for-dom-aisummarizercreateoptions-signal①\">signal</a></code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason\">abort reason</a>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options\" id=\"ref-for-validate-and-canonicalize-summarizer-options\">Validate and canonicalize summarizer options</a> given <var>options</var>. If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with②\">a promise rejected with</a> <var>e</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object\" id=\"ref-for-create-an-ai-model-object\">creating an AI model object</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a>, <var>options</var>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability\">computing summarizer options availability</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#download-the-summarization-model\" id=\"ref-for-download-the-summarization-model\">download the summarization model</a>, <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model\" id=\"ref-for-initialize-the-summarization-model\">initialize the summarization model</a>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#create-a-summarizer-object\" id=\"ref-for-create-a-summarizer-object\">create a summarizer object</a>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize summarizer options",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"validate-and-canonicalize-summarizer-options\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize summarizer options</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreatecoreoptions\" id=\"ref-for-dictdef-aisummarizercreatecoreoptions②\">AISummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags, and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages\">expectedInputLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags①\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages\">expectedContextLanguages</a></code>\".</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags\" id=\"ref-for-validate-and-canonicalize-language-tags②\">Validate and canonicalize language tags</a> given <var>options</var> and \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage\">outputLanguage</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "download the summarization model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#download-the-summarization-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"download-the-summarization-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">download the summarization model</dfn>, given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreatecoreoptions\" id=\"ref-for-dictdef-aisummarizercreatecoreoptions③\">AISummarizerCreateCoreOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Initiate the download process for everything the user agent needs to summarize text according to <var>options</var>. This could include a base AI model, fine-tunings for specific languages or option values, or other resources.</p>"
        },
        {
          "html": "<p>If the download process cannot be started for any reason, then return false.</p>"
        },
        {
          "html": "<p>Return true.</p>"
        }
      ]
    },
    {
      "name": "initialize the summarization model",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-the-summarization-model",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-the-summarization-model\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize the summarization model</dfn>, given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreateoptions\" id=\"ref-for-dictdef-aisummarizercreateoptions①\">AISummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform any necessary initialization operations for the AI model backing the user agent’s summarization capabilities.</p>\n      <p>This could include loading the model into memory, loading <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-sharedcontext\" id=\"ref-for-dom-aisummarizercreateoptions-sharedcontext\">sharedContext</a></code>\"] into the model’s context window, or loading any fine-tunings necessary to support the other options expressed by <var>options</var>.</p>"
        },
        {
          "html": "If initialization failed because the process of loading <var>options</var> resulted in using up all of the model’s input quota, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>requested</var> be the amount of input usage needed to encode <var>options</var>. The encoding of <var>options</var> as input is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined\">implementation-defined</a>.</p>"
            },
            {
              "html": "<p>Let <var>quota</var> be the maximum input quota that the user agent supports for encoding <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert②\">Assert</a>: <var>requested</var> is greater than <var>quota</var>. (That is how we reached this error branch.)</p>"
            },
            {
              "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information\">quota exceeded error information</a> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested\">requested</a> is <var>requested</var> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota\">quota</a> is <var>quota</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>If initialization failed for any other reason, then return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information\">DOMException error information</a> whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name\">name</a> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#operationerror\" id=\"ref-for-operationerror\">OperationError</a></code>\" and whose <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details\">details</a> contain appropriate detail.</p>"
        },
        {
          "html": "<p>Return null.</p>"
        }
      ]
    },
    {
      "name": "create a summarizer object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-a-summarizer-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-summarizer-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a summarizer object</dfn>, given a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm\">realm</a> <var>realm</var> and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreateoptions\" id=\"ref-for-dictdef-aisummarizercreateoptions②\">AISummarizerCreateOptions</a></code> <var>options</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert③\">Assert</a>: these steps are running on <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#surrounding-agent\" id=\"ref-for-surrounding-agent\">surrounding agent</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-agent-event-loop\" id=\"ref-for-concept-agent-event-loop\">event loop</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputQuota</var> be the amount of input quota that is available to the user agent for future <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize①\">summarization</a> operations. (This value is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined①\">implementation-defined</a>, and may be +∞ if there are no specific limits beyond, e.g., the user’s memory, or the limits of JavaScript strings.)</p>"
        },
        {
          "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer\" id=\"ref-for-aisummarizer③\">AISummarizer</a></code> object, created in <var>realm</var>, with</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context\">shared context</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreateoptions-sharedcontext\" id=\"ref-for-dom-aisummarizercreateoptions-sharedcontext①\">sharedContext</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type\">summary type</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-type\" id=\"ref-for-dom-aisummarizercreatecoreoptions-type\">type</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format\">summary format</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-format\" id=\"ref-for-dom-aisummarizercreatecoreoptions-format\">format</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length\">summary length</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-length\" id=\"ref-for-dom-aisummarizercreatecoreoptions-length\">length</a></code>\"]</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-expected-input-languages\" id=\"ref-for-aisummarizer-expected-input-languages\">expected input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages①\">expectedInputLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-expected-context-languages\" id=\"ref-for-aisummarizer-expected-context-languages\">expected context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array①\">creating a frozen array</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages①\">expectedContextLanguages</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-is-empty\" id=\"ref-for-list-is-empty①\">is not empty</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language\">output language</a>\n       </dt><dd data-md=\"\">\n        <p><var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage①\">outputLanguage</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists②\">exists</a>; otherwise null</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-input-quota\" id=\"ref-for-aisummarizer-input-quota\">input quota</a>\n       </dt><dd data-md=\"\">\n        <p><var>inputQuota</var></p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "AISummarizerFactory/availability(options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizerfactory-availability",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizerFactory\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"availability(options)|availability()\" id=\"dom-aisummarizerfactory-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>availability(<var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window①\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window①\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active①\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with③\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror①\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-summarizer-options\" id=\"ref-for-validate-and-canonicalize-summarizer-options①\">Validate and canonicalize summarizer options</a> given <var>options</var>.</p>"
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑤\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability\" id=\"ref-for-compute-summarizer-options-availability①\">computing summarizer options availability</a> given <var>options</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global②\">relevant global object</a> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>availability</var> is null, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code>.</p>"
                },
                {
                  "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve\">resolve</a> <var>promise</var> with <var>availability</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "compute summarizer options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-options-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-summarizer-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute summarizer options availability</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dictdef-aisummarizercreatecoreoptions\" id=\"ref-for-dictdef-aisummarizercreatecoreoptions④\">AISummarizerCreateCoreOptions</a></code> <var>options</var>, perform the following steps. They return either an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability①\">AIAvailability</a></code> value or null, and they mutate <var>options</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert④\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>availability</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability\" id=\"ref-for-summarizer-non-language-options-availability\">summarizer non-language options availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-type\" id=\"ref-for-dom-aisummarizercreatecoreoptions-type①\">type</a></code>\"], <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-format\" id=\"ref-for-dom-aisummarizercreatecoreoptions-format①\">format</a></code>\"], and <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-length\" id=\"ref-for-dom-aisummarizercreatecoreoptions-length①\">length</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>languageAvailabilities</var> be the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities\" id=\"ref-for-summarizer-language-availabilities\">summarizer language availabilities</a>.</p>"
        },
        {
          "html": "<p>If <var>languageAvailabilities</var> is null, then return null.</p>"
        },
        {
          "html": "<p>Let <var>inputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-language-availability\" id=\"ref-for-compute-summarizer-language-availability\">computing summarizer language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedinputlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedinputlanguages②\">expectedInputLanguages</a></code>\"] and <var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-input-languages\" id=\"ref-for-language-availabilities-input-languages\">input languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>contextLanguagesAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-language-availability\" id=\"ref-for-compute-summarizer-language-availability①\">computing summarizer language availability</a> given <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-expectedcontextlanguages\" id=\"ref-for-dom-aisummarizercreatecoreoptions-expectedcontextlanguages②\">expectedContextLanguages</a></code>\"] and <var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-context-languages\" id=\"ref-for-language-availabilities-context-languages\">context languages</a>.</p>"
        },
        {
          "html": "<p>Let <var>outputLanguagesList</var> be « <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage②\">outputLanguage</a></code>\"] ».</p>"
        },
        {
          "html": "<p>Let <var>outputLanguageAvailability</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-language-availability\" id=\"ref-for-compute-summarizer-language-availability②\">computing summarizer language availability</a> given <var>outputLanguagesList</var> and <var>languageAvailabilities</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-output-languages\" id=\"ref-for-language-availabilities-output-languages\">output languages</a>.</p>"
        },
        {
          "html": "<p>Set <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizercreatecoreoptions-outputlanguage\" id=\"ref-for-dom-aisummarizercreatecoreoptions-outputlanguage③\">outputLanguage</a></code>\"] to <var>outputLanguagesList</var>[0].</p>"
        },
        {
          "html": "<p>Return the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aiavailability-minimum-availability\" id=\"ref-for-aiavailability-minimum-availability\">minimum availability</a> given « <var>availability</var>, <var>inputLanguageAvailability</var>, <var>contextLanguagesAvailability</var>, <var>outputLanguageAvailability</var> ».</p>"
        }
      ]
    },
    {
      "name": "compute summarizer language availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#compute-summarizer-language-availability",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"compute-summarizer-language-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">compute summarizer language availability</dfn> given an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set\">ordered set</a> of strings <var>requestedLanguages</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map\">map</a> from <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability②\">AIAvailability</a></code> values to <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set①\">sets</a> of strings <var>availabilities</var>, perform the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability③\">AIAvailability</a></code> value, and they mutate <var>requestedLanguages</var> in place to update language tags to their best-fit matches.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>availability</var> be \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available\">available</a></code>\".</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate\">For each</a> <var>language</var> of <var>requestedLanguages</var>:",
          "rationale": "for",
          "steps": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate①\">For each</a> <var>availabilityToCheck</var> of « \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available①\">available</a></code>\", \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading\">downloading</a></code>\", \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable\">downloadable</a></code>\" »:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>languagesWithThisAvailability</var> be <var>availabilities</var>[<var>availabilityToCheck</var>].</p>"
                },
                {
                  "html": "<p>Let <var>bestMatch</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit\">LookupMatchingLocaleByBestFit</a>(<var>languagesWithThisAvailability</var>, « <var>language</var> »).</p>"
                },
                {
                  "html": "If <var>bestMatch</var> is not undefined, then:",
                  "rationale": "replace",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-replace\" id=\"ref-for-list-replace\">Replace</a> <var>language</var> with <var>bestMatch</var>.[[locale]] in <var>requestedLanguages</var>.</p>"
                    },
                    {
                      "html": "<p>Set <var>availability</var> to the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aiavailability-minimum-availability\" id=\"ref-for-aiavailability-minimum-availability①\">minimum availability</a> given <var>availability</var> and <var>availabilityToCheck</var>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break\">Break</a>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "<p>Return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-unavailable\" id=\"ref-for-dom-aiavailability-unavailable\">unavailable</a></code>\".</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>availability</var>.</p>"
        }
      ]
    },
    {
      "name": "summarizer non-language options availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-non-language-options-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer non-language options availability</dfn>, given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype②\">AISummarizerType</a></code> <var>type</var>, <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerformat\" id=\"ref-for-enumdef-aisummarizerformat②\">AISummarizerFormat</a></code> <var>format</var>, and an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerlength\" id=\"ref-for-enumdef-aisummarizerlength②\">AISummarizerLength</a></code> <var>length</var>, is given by the following steps. They return an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability④\">AIAvailability</a></code> value or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑤\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel④\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-non-language-options-availability\" id=\"ref-for-summarizer-non-language-options-availability①\">summarizer non-language options availability</a> could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>If the user agent supports summarizing text into the type of summary described by <var>type</var>, in the format described by <var>format</var>, and with the length guidance given by <var>length</var> without performing any downloading operations, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available②\">available</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can summarize text according to <var>type</var>, <var>format</var>, and <var>length</var>, but only after finishing a download (e.g., of an AI model or fine-tuning) that is already ongoing, then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable①\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>If the user agent believes it can summarize text according to <var>type</var>, <var>format</var>, and <var>length</var>, but only after performing a download (e.g., of an AI model or fine-tuning), then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable②\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Otherwise, return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-unavailable\" id=\"ref-for-dom-aiavailability-unavailable①\">unavailable</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "summarizer language availabilities",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarizer-language-availabilities\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarizer language availabilities</dfn> are given by the following steps. They return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities\" id=\"ref-for-language-availabilities\">language availabilities</a> or null.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑥\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑤\">in parallel</a>.</p>"
        },
        {
          "html": "<p>If there is some error attempting to determine whether the user agent supports summarizing text, which the user agent believes to be transient (such that re-querying the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-language-availabilities\" id=\"ref-for-summarizer-language-availabilities①\">summarizer language availabilities</a> could stop producing such an error), then return null.</p>"
        },
        {
          "html": "<p>Return a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities\" id=\"ref-for-language-availabilities①\">language availabilities</a> with:</p>\n      <dl class=\"props\">\n       <dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-input-languages\" id=\"ref-for-language-availabilities-input-languages①\">input languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-language-availabilities\" id=\"ref-for-get-language-availabilities\">getting language availabilities</a> given the purpose of summarizing text written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-context-languages\" id=\"ref-for-language-availabilities-context-languages①\">context languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-language-availabilities\" id=\"ref-for-get-language-availabilities①\">getting language availabilities</a> given the purpose of summarizing text using web-developer provided context information written in that language</p>\n       </dd><dt data-md=\"\"><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-availabilities-output-languages\" id=\"ref-for-language-availabilities-output-languages①\">output languages</a>\n       </dt><dd data-md=\"\">\n        <p>the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-language-availabilities\" id=\"ref-for-get-language-availabilities②\">getting language availabilities</a> given the purpose of producing text summaries in that language</p>\n      </dd></dl>"
        }
      ]
    },
    {
      "name": "AISummarizer/summarize(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizer-summarize",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarize(input, options)|summarize(input)\" id=\"dom-aisummarizer-summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarize(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-context\" id=\"ref-for-dom-aisummarizersummarizeoptions-context\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists③\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize②\">summarizes</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context②\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type②\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format②\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length②\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language②\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-input-quota\" id=\"ref-for-aisummarizer-input-quota②\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result\" id=\"ref-for-get-an-aggregated-ai-model-result\">getting an aggregated AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②②\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "AISummarizer/summarizeStreaming(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizer-summarizestreaming",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"summarizeStreaming(input, options)|summarizeStreaming(input)\" id=\"dom-aisummarizer-summarizestreaming\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>summarizeStreaming(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-context\" id=\"ref-for-dom-aisummarizersummarizeoptions-context①\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists④\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>operation</var> be an algorithm step which takes arguments <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>, and <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize③\">summarizes</a> <var>input</var> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context③\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type③\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑤\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format③\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length③\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language③\">output language</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-input-quota\" id=\"ref-for-aisummarizer-input-quota③\">input quota</a>, <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result\" id=\"ref-for-get-a-streaming-ai-model-result\">getting a streaming AI model result</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②⑨\">this</a>, <var>options</var>, and <var>operation</var>.</p>"
        }
      ]
    },
    {
      "name": "AISummarizer/measureInputUsage(input, options)",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizer-measureinputusage",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"AISummarizer\" data-dfn-type=\"method\" data-export=\"\" data-lt=\"measureInputUsage(input, options)|measureInputUsage(input)\" id=\"dom-aisummarizer-measureinputusage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>measureInputUsage(<var>input</var>, <var>options</var>)</code></dfn> method steps are:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>context</var> be <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-context\" id=\"ref-for-dom-aisummarizersummarizeoptions-context②\">context</a></code>\"] if it <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑤\">exists</a>; otherwise null.</p>"
        },
        {
          "html": "<p>Let <var>measureUsage</var> be an algorithm step which takes argument <var>stopMeasuring</var>, and returns the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage\" id=\"ref-for-measure-summarizer-input-usage\">measuring summarizer input usage</a> given <var>input</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⓪\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-shared-context\" id=\"ref-for-aisummarizer-shared-context④\">shared context</a>, <var>context</var>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③①\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-type\" id=\"ref-for-aisummarizer-summary-type④\">summary type</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③②\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-format\" id=\"ref-for-aisummarizer-summary-format④\">summary format</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③③\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-summary-length\" id=\"ref-for-aisummarizer-summary-length④\">summary length</a>, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③④\">this</a>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-output-language\" id=\"ref-for-aisummarizer-output-language④\">output language</a>, and <var>stopMeasuring</var>.</p>"
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage\" id=\"ref-for-measure-ai-model-input-usage\">measuring AI model input usage</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑤\">this</a>, <var>options</var>, and <var>measureUsage</var>.</p>"
        }
      ]
    },
    {
      "name": "summarize",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#summarize",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"summarize\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">summarize</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string②\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string③\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string④\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype④\">AISummarizerType</a></code> <var>type</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerformat\" id=\"ref-for-enumdef-aisummarizerformat④\">AISummarizerFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerlength\" id=\"ref-for-enumdef-aisummarizerlength④\">AISummarizerLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑤\">string</a>-or-null <var>outputLanguage</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://drafts.csswg.org/css-values-4/#number\" id=\"ref-for-number\">number</a> <var>inputQuota</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>chunkProduced</var> that takes a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑥\">string</a> and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>done</var> that takes no arguments and returns nothing,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>error</var> that takes <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information\">error information</a> and returns nothing, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopProducing</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑦\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑥\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>requested</var> be the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage\" id=\"ref-for-measure-summarizer-input-usage①\">measuring summarizer input usage</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, <var>outputLanguage</var>, and <var>stopProducing</var>.</p>"
        },
        {
          "html": "<p>If <var>requested</var> is null, then return.</p>"
        },
        {
          "html": "If <var>requested</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information①\">error information</a>, then:",
          "rationale": "perform",
          "steps": [
            {
              "html": "<p>Perform <var>error</var> given <var>requested</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑧\">Assert</a>: <var>requested</var> is a number.</p>"
        },
        {
          "html": "If <var>requested</var> is greater than <var>inputQuota</var>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>errorInfo</var> be a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information①\">quota exceeded error information</a> with a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested\">requested</a> of <var>requested</var> and a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota\">quota</a> of <var>inputQuota</var>.</p>"
            },
            {
              "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
            },
            {
              "html": "<p>Return.</p>"
            }
          ]
        },
        {
          "html": "<p>In an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined②\">implementation-defined</a> manner, subject to the following guidelines, begin the processs of summarizing <var>input</var> into a string.</p>\n      <p>If they are non-null, <var>sharedContext</var> and <var>context</var> should be used to aid in the summarization by providing context on how the web developer wishes the input to be summarized.</p>\n      <p>If <var>input</var> is the empty string, or otherwise consists of no summarizable content (e.g., only contains whitespace, or control characters), then the resulting summary should be the empty string. In such cases, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var> should be ignored.</p>\n      <p>The summarization should conform to the guidance given by <var>type</var>, <var>format</var>, and <var>length</var>, in the definitions of each of their enumeration values.</p>\n      <p>If <var>outputLanguage</var> is non-null, the summarization should be in that language. Otherwise, it should be in the language of <var>input</var> (which might not match that of <var>context</var> or <var>sharedContext</var>). If <var>input</var> contains multiple languages, or the language of <var>input</var> cannot be detected, then either the output language is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined③\">implementation-defined</a>, or the implementation may treat this as an error, per the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.4.4 Errors</a>.</p>"
        },
        {
          "html": "While true:",
          "rationale": "wait",
          "steps": [
            {
              "html": "<p>Wait for the next chunk of summarization data to be produced, for the summarization process to finish, or for the result of calling <var>stopProducing</var> to become true.</p>"
            },
            {
              "html": "If such a chunk is successfully produced:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let it be represented as a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑦\">string</a> <var>chunk</var>.</p>"
                },
                {
                  "html": "<p>Perform <var>chunkProduced</var> given <var>chunk</var>.</p>"
                }
              ]
            },
            {
              "html": "Otherwise, if the summarization process has finished:",
              "rationale": "perform",
              "steps": [
                {
                  "html": "<p>Perform <var>done</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break①\">Break</a>.</p>"
                }
              ]
            },
            {
              "html": "<p>Otherwise, if <var>stopProducing</var> returns true, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break②\">break</a>.</p>"
            },
            {
              "html": "Otherwise, if an error occurred during summarization:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let the error be represented as <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information②\">error information</a> <var>errorInfo</var> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.4.4 Errors</a>.</p>"
                },
                {
                  "html": "<p>Perform <var>error</var> given <var>errorInfo</var>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break③\">Break</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "measure summarizer input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-summarizer-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"measure-summarizer-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure summarizer input usage</dfn>, given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑧\">string</a> <var>input</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string⑨\">string</a>-or-null <var>sharedContext</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⓪\">string</a>-or-null <var>context</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑤\">AISummarizerType</a></code> <var>type</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerformat\" id=\"ref-for-enumdef-aisummarizerformat⑤\">AISummarizerFormat</a></code> <var>format</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizerlength\" id=\"ref-for-enumdef-aisummarizerlength⑤\">AISummarizerLength</a></code> <var>length</var>,</p>\n     </li><li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①①\">string</a>-or-null <var>outputLanguage</var>, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>stopMeasuring</var> that takes no arguments and returns a boolean,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert⑨\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑦\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Let <var>inputToModel</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined④\">implementation-defined</a> string that would be sent to the underlying model in order to <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarize\" id=\"ref-for-summarize④\">summarize</a> given <var>input</var>, <var>sharedContext</var>, <var>context</var>, <var>type</var>, <var>format</var>, <var>length</var>, and <var>outputLanguage</var>.</p>\n      \n      <p>If during this process <var>stopMeasuring</var> starts returning true, then return null.</p>\n      <p>If an error occurs during this process, then return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information①\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.4.4 Errors</a>.</p>"
        },
        {
          "html": "<p>Return the amount of input usage needed to represent <var>inputToModel</var> when given to the underlying model. The exact calculation procedure is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑤\">implementation-defined</a>, subject to the following constraints.</p>\n      <p>The returned input usage must be nonnegative and finite. It must be 0, if there are no usage quotas for the summarization process (i.e., if the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aisummarizer-input-quota\" id=\"ref-for-aisummarizer-input-quota⑤\">input quota</a> is +∞). Otherwise, it must be positive and should be roughly proportional to the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string-length\" id=\"ref-for-string-length\">length</a> of <var>inputToModel</var>.</p>\n      \n      <p>If during this process <var>stopMeasuring</var> starts returning true, then instead return null.</p>\n      <p>If an error occurs during this process, then instead return an appropriate <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information②\">DOMException error information</a> according to the guidance in <a href=\"https://webmachinelearning.github.io/writing-assistance-apis/#summarizer-errors\">§ 3.4.4 Errors</a>.</p>"
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑧\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 sentence.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 3 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 12 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype⑨\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 short paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 5 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 17 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "html": "The guidance is dependent on the value of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aisummarizertype\" id=\"ref-for-enumdef-aisummarizertype①⓪\">AISummarizerType</a></code>:",
      "rationale": ".switch",
      "steps": [
        {
          "operation": "switch",
          "steps": [
            {
              "case": "\"tl;dr\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"teaser\"",
              "html": "<p>The summary should fit within 1 paragraph.</p>"
            },
            {
              "case": "\"key-points\"",
              "html": "<p>The summary should consist of no more than 7 bullet points.</p>"
            },
            {
              "case": "\"headline\"",
              "html": "<p>The summary should use no more than 22 words.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "create an AI model object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#create-an-ai-model-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"create-an-ai-model-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create an AI model object</dfn> given: \n    <ul>\n     <li data-md=\"\">\n      <p>a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm①\">realm</a> <var>realm</var>,</p>\n     </li><li data-md=\"\">\n      <p>an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map②\">ordered map</a> <var>options</var>,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>getAvailability</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map③\">ordered map</a> and returning an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability⑧\">AIAvailability</a></code> or null,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>startDownload</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map④\">ordered map</a> and returning a boolean,</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>initialize</var> taking an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑤\">ordered map</a> and returning an error information or null, and</p>\n     </li><li data-md=\"\">\n      <p>an algorithm <var>create</var> taking a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma262/multipage/executable-code-and-execution-contexts.html#realm\" id=\"ref-for-realm②\">realm</a> and an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑥\">ordered map</a> and returning a Web IDL object representing the model,</p>\n    </li></ul>\n    <p>perform the following steps:</p>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>fireProgressEvent</var> be an algorithm taking two arguments that does nothing.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code>monitor</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑥\">exists</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>monitor</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new④\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aicreatemonitor\" id=\"ref-for-aicreatemonitor②\">AICreateMonitor</a></code> created in <var>realm</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#invoke-a-callback-function\" id=\"ref-for-invoke-a-callback-function\">Invoke</a> <var>options</var>[\"<code>monitor</code>\"] with « <var>monitor</var> » and \"<code>rethrow</code>\".</p>\n        <p>If this throws an exception <var>e</var>, catch it, and return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with④\">a promise rejected with</a> <var>e</var>.</p>"
            },
            {
              "html": "Set <var>fireProgressEvent</var> to an algorithm taking argument <var>loaded</var>, which performs the following steps:",
              "rationale": "assert",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⓪\">Assert</a>: this algorithm is running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel⑧\">in parallel</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global\">global object</a> to perform the following steps:",
                  "rationale": "fire",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-event-fire\" id=\"ref-for-concept-event-fire\">Fire an event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#eventdef-aicreatemonitor-downloadprogress\" id=\"ref-for-eventdef-aicreatemonitor-downloadprogress\">downloadprogress</a></code> at <var>monitor</var>, using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#progressevent\" id=\"ref-for-progressevent\">ProgressEvent</a></code>, with the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-loaded\" id=\"ref-for-dom-progressevent-loaded\">loaded</a></code> attribute initialized to <var>loaded</var>, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-total\" id=\"ref-for-dom-progressevent-total\">total</a></code> attribute initialized to 1, and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-lengthcomputable\" id=\"ref-for-dom-progressevent-lengthcomputable\">lengthComputable</a></code> attribute initialized to true.</p>\n            <p class=\"advisement\">This assumes <a href=\"https://github.com/whatwg/xhr/pull/394\">whatwg/xhr#394</a> is merged so that passing non-integer values for <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://xhr.spec.whatwg.org/#dom-progressevent-loaded\" id=\"ref-for-dom-progressevent-loaded①\">loaded</a></code> works as expected.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Let <var>abortedDuringDownload</var> be false.</p>"
        },
        {
          "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑦\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add\">add the following abort steps</a> to <var>options</var>[\"<code>signal</code>\"]:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringDownload</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a> created in <var>realm</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>availability</var> be the result of performing <var>getAvailability</var> given <var>options</var>.</p>"
            },
            {
              "html": "<p>Switch on <var>availability</var>:</p>"
            }
          ],
          "additional": [
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⓪\">In parallel</a>:",
              "rationale": ".switch",
              "steps": [
                {
                  "operation": "switch",
                  "steps": [
                    {
                      "case": "null",
                      "html": "",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>promise</var> with an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#unknownerror\" id=\"ref-for-unknownerror②\">UnknownError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"unavailable\"",
                      "html": "",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">Reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notsupportederror\" id=\"ref-for-notsupportederror①\">NotSupportedError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code>.</p>"
                        },
                        {
                          "html": "<p>Abort these steps.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"available\"",
                      "html": "",
                      "rationale": "initialize",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, <var>fireProgressEvent</var>, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"downloading\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>availability</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable⑥\">downloadable</a></code>\", then let <var>startDownloadResult</var> be the result of performing <var>startDownload</var> given <var>options</var>.</p>"
                        },
                        {
                          "html": "If <var>startDownloadResult</var> is false, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source②\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "Run the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>abortedDuringDownload</var> becomes true:",
                          "rationale": "wait",
                          "steps": [
                            {
                              "html": "<p>Wait for the total number of bytes to be downloaded to become determined, and let that number be <var>totalBytes</var>.</p>\n            <p>This number must be equal to the number of bytes that the user agent needs to download at the present time, not including any that have already been downloaded.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressFraction</var> be 0.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time\">unsafe current time</a>.</p>"
                            },
                            {
                              "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
                            },
                            {
                              "html": "While true:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If downloading has failed, then:",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source③\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>Abort these steps.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Let <var>bytesSoFar</var> be the number of bytes downloaded so far.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: <var>bytesSoFar</var> is greater than or equal to 0, and less than or equal to <var>totalBytes</var>.</p>"
                                },
                                {
                                  "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock①\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time①\">unsafe current time</a> minus <var>lastProgressTime</var> is greater than 50 ms, or <var>bytesSoFar</var> equals <var>totalBytes</var>, then:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>rawProgressFraction</var> be <var>bytesSoFar</var> divided by <var>totalBytes</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>progressFraction</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/#eqn-floor\" id=\"ref-for-eqn-floor\">floor</a>(<var>rawProgressFraction</var> × 65,536) ÷ 65,536.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>progressFraction</var> is not equal to <var>lastProgressFraction</var>, then perform <var>fireProgressEvent</var> given <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>bytesSoFar</var> equals <var>totalBytes</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break④\">break</a>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressFraction</var> to <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock②\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time②\">unsafe current time</a>.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source④\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a> to perform the following steps:",
                              "rationale": "assert",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a>: <var>options</var>[\"<code>signal</code>\"] is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object①\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, a no-op algorithm, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    },
                    {
                      "case": "\"downloadable\"",
                      "html": "",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "<p>If <var>availability</var> is \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable⑥\">downloadable</a></code>\", then let <var>startDownloadResult</var> be the result of performing <var>startDownload</var> given <var>options</var>.</p>"
                        },
                        {
                          "html": "If <var>startDownloadResult</var> is false, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source②\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global①\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code>.</p>"
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "Run the following steps, but <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#abort-when\" id=\"ref-for-abort-when\">abort when</a> <var>abortedDuringDownload</var> becomes true:",
                          "rationale": "wait",
                          "steps": [
                            {
                              "html": "<p>Wait for the total number of bytes to be downloaded to become determined, and let that number be <var>totalBytes</var>.</p>\n            <p>This number must be equal to the number of bytes that the user agent needs to download at the present time, not including any that have already been downloaded.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressFraction</var> be 0.</p>"
                            },
                            {
                              "html": "<p>Let <var>lastProgressTime</var> be the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time\">unsafe current time</a>.</p>"
                            },
                            {
                              "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
                            },
                            {
                              "html": "While true:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If downloading has failed, then:",
                                  "rationale": "queue",
                                  "steps": [
                                    {
                                      "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source③\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global②\">global object</a> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">reject</a> <var>promise</var> with a \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#networkerror\" id=\"ref-for-networkerror①\">NetworkError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑨\">DOMException</a></code>.</p>"
                                    },
                                    {
                                      "html": "<p>Abort these steps.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>Let <var>bytesSoFar</var> be the number of bytes downloaded so far.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①①\">Assert</a>: <var>bytesSoFar</var> is greater than or equal to 0, and less than or equal to <var>totalBytes</var>.</p>"
                                },
                                {
                                  "html": "If the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock①\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time①\">unsafe current time</a> minus <var>lastProgressTime</var> is greater than 50 ms, or <var>bytesSoFar</var> equals <var>totalBytes</var>, then:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>rawProgressFraction</var> be <var>bytesSoFar</var> divided by <var>totalBytes</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>progressFraction</var> be <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma262/#eqn-floor\" id=\"ref-for-eqn-floor\">floor</a>(<var>rawProgressFraction</var> × 65,536) ÷ 65,536.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>progressFraction</var> is not equal to <var>lastProgressFraction</var>, then perform <var>fireProgressEvent</var> given <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>If <var>bytesSoFar</var> equals <var>totalBytes</var>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-break\" id=\"ref-for-iteration-break④\">break</a>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressFraction</var> to <var>progressFraction</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Set <var>lastProgressTime</var> to the <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#dfn-monotonic-clock\" id=\"ref-for-dfn-monotonic-clock②\">monotonic clock</a>’s <a data-link-type=\"dfn\" href=\"https://w3c.github.io/hr-time/#monotonic-clock-unsafe-current-time\" id=\"ref-for-monotonic-clock-unsafe-current-time②\">unsafe current time</a>.</p>"
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#if-aborted\" id=\"ref-for-if-aborted\">If aborted</a>, then:",
                          "rationale": "queue",
                          "steps": [
                            {
                              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source④\">AI task source</a> given <var>realm</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-realm-global\" id=\"ref-for-concept-realm-global③\">global object</a> to perform the following steps:",
                              "rationale": "assert",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①②\">Assert</a>: <var>options</var>[\"<code>signal</code>\"] is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted①\">aborted</a>.</p>"
                                },
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①\">abort reason</a>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object\" id=\"ref-for-initialize-and-return-an-ai-model-object①\">Initialize and return an AI model object</a> given <var>promise</var>, <var>options</var>, a no-op algorithm, <var>initialize</var>, and <var>create</var>.</p>"
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "initialize and return an AI model object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#initialize-and-return-an-ai-model-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"initialize-and-return-an-ai-model-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">initialize and return an AI model object</dfn> given a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-promise\" id=\"ref-for-idl-promise①②\">Promise</a></code> <var>promise</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑦\">ordered map</a> <var>options</var>, and algorithms <var>fireProgressEvent</var>, <var>initialize</var>, and <var>create</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①③\">Assert</a>: these steps are running <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①①\">in parallel</a>.</p>"
        },
        {
          "html": "<p>Perform <var>fireProgressEvent</var> given 0.</p>"
        },
        {
          "html": "<p>Perform <var>fireProgressEvent</var> given 1.</p>"
        },
        {
          "html": "<p>Let <var>result</var> be the result of performing <var>initialize</var> given <var>options</var>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑤\">AI task source</a> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global③\">relevant global object</a> to perform the following steps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑧\">exists</a> and is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted②\">aborted</a>, then:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">Reject</a> <var>promise</var> with <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason②\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "If <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information③\">error information</a>, then:",
              "rationale": "reject",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">Reject</a> <var>promise</var> with the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object\">converting error information into an exception object</a> given <var>result</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>model</var> be the result of performing <var>create</var> given <var>promise</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global④\">relevant global object</a> and <var>options</var>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①④\">Assert</a>: <var>model</var> <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#implements\" id=\"ref-for-implements\">implements</a> an <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-interface\" id=\"ref-for-dfn-interface①\">interface</a> that <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#include\" id=\"ref-for-include①\">includes</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable⑥\">AIDestroyable</a></code>.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#initialize-as-a-destroyable\" id=\"ref-for-initialize-as-a-destroyable①\">Initialize as a destroyable</a> <var>model</var>.</p>"
            },
            {
              "html": "If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists⑨\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add①\">add the following abort steps</a> to <var>options</var>[\"<code>signal</code>\"]:",
              "rationale": "destroy",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destroy\" id=\"ref-for-aidestroyable-destroy①\">Destroy</a> <var>model</var> given <var>options</var>[\"<code>signal</code>\"]'s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason③\">abort reason</a>.</p>"
                }
              ]
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve①\">Resolve</a> <var>promise</var> with <var>model</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "get an aggregated AI model result",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-an-aggregated-ai-model-result",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-an-aggregated-ai-model-result\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get an aggregated AI model result</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable⑦\">AIDestroyable</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑧\">ordered map</a> <var>options</var>, and an algorithm <var>operation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑤\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window②\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window②\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active②\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑤\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror②\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⓪\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destruction-abort-controller\" id=\"ref-for-aidestroyable-destruction-abort-controller③\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal①\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⓪\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal①\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①⓪\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑥\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted④\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑥\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason④\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add②\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> created in <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑦\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①③\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>result</var> be the empty string.</p>"
            },
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①②\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑥\">AI task source</a> given <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑥\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑤\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, append <var>chunk</var> to <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑦\">AI task source</a> given <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑦\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑥\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve②\">resolve</a> <var>promise</var> with <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information④\">error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑧\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑧\">AI task source</a> given <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑧\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑦\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①①\">reject</a> <var>promise</var> with the result <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object①\">converting error information into an exception object</a> given <var>errorInfo</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>abortedDuringOperation</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Perform <var>operation</var> given <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "get a streaming AI model result",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-a-streaming-ai-model-result",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-a-streaming-ai-model-result\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get a streaming AI model result</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable⑧\">AIDestroyable</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map⑨\">ordered map</a> <var>options</var>, and an algorithm <var>operation</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global⑨\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window③\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window③\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active③\">fully active</a>, then throw an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror③\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①①\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destruction-abort-controller\" id=\"ref-for-aidestroyable-destruction-abort-controller④\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal②\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aisummarizersummarizeoptions-signal\" id=\"ref-for-dom-aisummarizersummarizeoptions-signal\">signal</a></code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①①\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append①\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal②\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①①\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑧\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted⑤\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑦\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑧\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add③\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>stream</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new⑤\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://streams.spec.whatwg.org/#readablestream\" id=\"ref-for-readablestream③\">ReadableStream</a></code> created in <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑥\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm⑨\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>canceledDuringOperation</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up\" id=\"ref-for-readablestream-set-up\">Set up</a> <var>stream</var> with <i><a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm\" id=\"ref-for-readablestream-set-up-cancelalgorithm\">cancelAlgorithm</a></i> set to the following steps (ignoring the <var>reason</var> argument):",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>canceledDuringOperation</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑥\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>chunkProduced</var> be the following steps given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①③\">string</a> <var>chunk</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑨\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source⑨\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑦\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①⓪\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason⑨\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-enqueue\" id=\"ref-for-readablestream-enqueue\">enqueue</a> <var>chunk</var> into <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>done</var> be the following steps:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①⓪\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①⓪\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑧\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①①\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error①\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①⓪\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-close\" id=\"ref-for-readablestream-close\">close</a> <var>stream</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>error</var> be the following steps given <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑤\">error information</a> <var>errorInfo</var>:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①①\">AI task source</a> given <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③⑨\">this</a>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①②\">relevant global object</a> to perform the following steps:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "<p>If <var>abortedDuringOperation</var> is true, then <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error②\">error</a> <var>stream</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①①\">abort reason</a>.</p>"
                    },
                    {
                      "html": "<p>Otherwise, <a data-link-type=\"dfn\" href=\"https://streams.spec.whatwg.org/#readablestream-error\" id=\"ref-for-readablestream-error③\">error</a> <var>stream</var> with the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object②\">converting error information into an exception object</a> given <var>errorInfo</var>.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "Let <var>stopProducing</var> be the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If either <var>abortedDuringOperation</var> or <var>canceledDuringOperation</var> are true, then return true.</p>"
                },
                {
                  "html": "<p>Return false.</p>"
                }
              ]
            },
            {
              "html": "<p>Perform <var>operation</var> given <var>chunkProduced</var>, <var>done</var>, <var>error</var>, and <var>stopProducing</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Return <var>stream</var>.</p>"
        }
      ]
    },
    {
      "name": "measure AI model input usage",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#measure-ai-model-input-usage",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"measure-ai-model-input-usage\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">measure AI model input usage</dfn> given an <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable\" id=\"ref-for-aidestroyable⑨\">AIDestroyable</a></code> <var>modelObject</var>, an <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①⓪\">ordered map</a> <var>options</var>, and an algorithm <var>measure</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①③\">relevant global object</a> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#window\" id=\"ref-for-window④\">Window</a></code> whose <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/nav-history-apis.html#concept-document-window\" id=\"ref-for-concept-document-window④\">associated Document</a> is not <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/document-sequences.html#fully-active\" id=\"ref-for-fully-active④\">fully active</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑧\">a promise rejected with</a> an \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#invalidstateerror\" id=\"ref-for-invalidstateerror④\">InvalidStateError</a></code>\" <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①②\">DOMException</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>signals</var> be « <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#aidestroyable-destruction-abort-controller\" id=\"ref-for-aidestroyable-destruction-abort-controller⑤\">destruction abort controller</a>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortcontroller-signal\" id=\"ref-for-abortcontroller-signal③\">signal</a> ».</p>"
        },
        {
          "html": "<p>If <var>options</var>[\"<code>signal</code>\"] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①②\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append②\">append</a> it to <var>signals</var>.</p>"
        },
        {
          "html": "<p>Let <var>compositeSignal</var> be the result of <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#create-a-dependent-abort-signal\" id=\"ref-for-create-a-dependent-abort-signal③\">creating a dependent abort signal</a> given <var>signals</var> using <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#abortsignal\" id=\"ref-for-abortsignal①②\">AbortSignal</a></code> and <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①⓪\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>If <var>compositeSignal</var> is <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-aborted\" id=\"ref-for-abortsignal-aborted⑥\">aborted</a>, then return <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-promise-rejected-with\" id=\"ref-for-a-promise-rejected-with⑨\">a promise rejected with</a> <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①②\">abort reason</a>.</p>"
        },
        {
          "html": "<p>Let <var>abortedDuringMeasurement</var> be false.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-add\" id=\"ref-for-abortsignal-add④\">Add the following abort steps</a> to <var>compositeSignal</var>:",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set <var>abortedDuringMeasurement</var> to true.</p>"
            }
          ]
        },
        {
          "html": "<p>Let <var>promise</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a> created in <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①①\">relevant realm</a>.</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①⑧\">In parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "Let <var>stopMeasuring</var> be the following steps:",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return <var>abortedDuringMeasurement</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>result</var> be the result of performing <var>measure</var> given <var>stopMeasuring</var>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①②\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#ai-task-source\" id=\"ref-for-ai-task-source①②\">AI task source</a> given <var>modelObject</var>’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①④\">relevant global object</a> to perform the following steps:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <var>abortedDuringMeasurement</var> is true, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①②\">reject</a> <var>promise</var> with <var>compositeSignal</var>’s <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#abortsignal-abort-reason\" id=\"ref-for-abortsignal-abort-reason①③\">abort reason</a>.</p>"
                },
                {
                  "html": "<p>Otherwise, if <var>result</var> is an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑥\">error information</a>, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①③\">reject</a> <var>promise</var> with the result <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object\" id=\"ref-for-convert-error-information-into-an-exception-object③\">converting error information into an exception object</a> given <var>result</var>.</p>"
                },
                {
                  "html": "Otherwise,",
                  "rationale": "assert",
                  "steps": [
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑤\">Assert</a>: <var>result</var> is a number. (It is not null, since in that case <var>abortedDuringMeasurement</var> would have been true.)</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#resolve\" id=\"ref-for-resolve③\">Resolve</a> <var>promise</var> with <var>result</var>.</p>"
                    }
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>promise</var>.</p>"
        }
      ]
    },
    {
      "name": "validate and canonicalize language tags",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-language-tags",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"validate-and-canonicalize-language-tags\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize language tags</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-map\" id=\"ref-for-ordered-map①①\">ordered map</a> <var>options</var> and a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①④\">string</a> <var>key</var>, perform the following steps. They mutate <var>options</var> in place to canonicalize and deduplicate language tags found in <var>options</var>[<var>key</var>], and throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code> if any are invalid.",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑥\">Assert</a>: <var>options</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①③\">exists</a>.</p>"
        },
        {
          "html": "<p>If <var>options</var>[<var>key</var>] is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑤\">string</a>, then set <var>options</var>[<var>key</var>] to the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag\" id=\"ref-for-validate-and-canonicalize-a-single-language-tag\">validating and canonicalizing a single language tag</a> given <var>options</var>[<var>key</var>].</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑦\">Assert</a>: <var>options</var>[<var>key</var>] either does not <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①④\">exist</a>, or it is a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list\">list</a> of <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑥\">strings</a>.</p>"
            },
            {
              "html": "<p>Let <var>languageTags</var> be an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set③\">ordered set</a>.</p>"
            },
            {
              "html": "If <var>options</var>[<var>key</var>] <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#map-exists\" id=\"ref-for-map-exists①⑤\">exists</a>, then <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate②\">for each</a> <var>languageTag</var> of <var>options</var>[<var>key</var>]:",
              "rationale": "if",
              "steps": [
                {
                  "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag\">IsStructurallyValidLanguageTag</a>(<var>languageTag</var>) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append③\">Append</a> the result of <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag\" id=\"ref-for-validate-and-canonicalize-a-single-language-tag①\">validating and canonicalizing a single language tag</a> to <var>languageTags</var>.</p>"
                }
              ]
            },
            {
              "html": "<p>Set <var>options</var>[<var>key</var>] to <var>languageTags</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "validate and canonicalize a single language tag",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#validate-and-canonicalize-a-single-language-tag",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-lt=\"validate and canonicalize a single language tag|validating and canonicalizing a single language tag\" data-noexport=\"\" id=\"validate-and-canonicalize-a-single-language-tag\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">validate and canonicalize a single language tag</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#string\" id=\"ref-for-string①⑦\">string</a> <var>potentialLanguageTag</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-isstructurallyvalidlanguagetag\" id=\"ref-for-sec-isstructurallyvalidlanguagetag①\">IsStructurallyValidLanguageTag</a>(<var>potentialLanguageTag</var>) is false, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Return <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-canonicalizeunicodelocaleid\" id=\"ref-for-sec-canonicalizeunicodelocaleid\">CanonicalizeUnicodeLocaleId</a>(<var>potentialLanguageTag</var>).</p>"
        }
      ]
    },
    {
      "name": "get language availabilities",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#get-language-availabilities",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"get-language-availabilities\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">get language availabilities</dfn> given a description <var>purpose</var> of the purpose for which we’re checking language availability:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>availabilities</var> be «[ \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available⑥\">available</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set④\">set</a>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading③\">downloading</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑤\">set</a>, \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable⑦\">downloadable</a></code>\" → an empty <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑥\">set</a> ]».</p>"
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate③\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags①\">Unicode canonicalized locale identifier</a>, for which the user agent supports <var>purpose</var>, without performing any downloading operations:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append④\">Append</a> <var>languageTag</var> to <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available⑦\">available</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate④\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags②\">Unicode canonicalized locale identifier</a>, for which the user agent is currently downloading material (e.g., an AI model or fine-tuning) to support <var>purpose</var>:",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑤\">Append</a> <var>languageTag</var> to <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading④\">downloading</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑤\">For each</a> human language <var>languageTag</var>, represented as a <a data-link-type=\"dfn\" href=\"https://tc39.es/ecma402/#sec-language-tags\" id=\"ref-for-sec-language-tags③\">Unicode canonicalized locale identifier</a>, for which the user agent believes it can support <var>purpose</var>, but only after performing a not-currently-ongoing download (e.g., of an AI model or fine-tuning):",
          "rationale": "append",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑥\">Append</a> <var>languageTag</var> to <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable⑧\">downloadable</a></code>\"].</p>"
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑧\">Assert</a>: <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available⑧\">available</a></code>\"], <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading⑤\">downloading</a></code>\"], and <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable⑨\">downloadable</a></code>\"] are disjoint.</p>"
        },
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-union\" id=\"ref-for-set-union\">union</a> of <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available⑨\">available</a></code>\"], <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading⑥\">downloading</a></code>\"], and <var>availabilities</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable①⓪\">downloadable</a></code>\"] does not meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules①\">language tag set completeness rules</a>, then:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>missingLanguageTags</var> be the <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#ordered-set\" id=\"ref-for-ordered-set⑦\">set</a> of missing language tags necessary to meet the <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#language-tag-set-completeness-rules\" id=\"ref-for-language-tag-set-completeness-rules②\">language tag set completeness rules</a>.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-iterate\" id=\"ref-for-list-iterate⑥\">For each</a> <var>languageTag</var> of <var>missingLanguageTags</var>:",
              "rationale": "append",
              "steps": [
                {
                  "html": "<p><span id=\"language-tag-completeness-implementation-defined\"></span> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#set-append\" id=\"ref-for-set-append⑦\">Append</a> <var>languageTag</var> to one of the three sets. Which of the sets to append to is <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#implementation-defined\" id=\"ref-for-implementation-defined⑧\">implementation-defined</a>, and should be guided by considerations similar to that of <a data-link-type=\"abstract-op\" href=\"https://tc39.es/ecma402/#sec-lookupmatchinglocalebybestfit\" id=\"ref-for-sec-lookupmatchinglocalebybestfit②\">LookupMatchingLocaleByBestFit</a> in terms of keeping \"best fallback languages\" together.</p>"
                }
              ]
            },
            {
              "html": "<p>Return <var>availabilities</var>.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "AIAvailability/minimum availability",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#aiavailability-minimum-availability",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-for=\"AIAvailability\" data-dfn-type=\"dfn\" data-export=\"\" id=\"aiavailability-minimum-availability\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">minimum availability</dfn> given a <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list\" id=\"ref-for-list①\">list</a> of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#enumdef-aiavailability\" id=\"ref-for-enumdef-aiavailability⑨\">AIAvailability</a></code>-or-null values <var>availabilities</var> is:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> null, then return null.</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain①\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-unavailable\" id=\"ref-for-dom-aiavailability-unavailable④\">unavailable</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-unavailable\" id=\"ref-for-dom-aiavailability-unavailable⑤\">unavailable</a></code>\".</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain②\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading⑦\">downloading</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloading\" id=\"ref-for-dom-aiavailability-downloading⑧\">downloading</a></code>\".</p>"
        },
        {
          "html": "<p>If <var>availabilities</var> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain③\">contains</a> \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable①①\">downloadable</a></code>\", then return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-downloadable\" id=\"ref-for-dom-aiavailability-downloadable①②\">downloadable</a></code>\".</p>"
        },
        {
          "html": "<p>Return \"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#dom-aiavailability-available\" id=\"ref-for-dom-aiavailability-available①⓪\">available</a></code>\".</p>"
        }
      ]
    },
    {
      "name": "convert error information into an exception object",
      "href": "https://webmachinelearning.github.io/writing-assistance-apis/#convert-error-information-into-an-exception-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-export=\"\" id=\"convert-error-information-into-an-exception-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">convert error information into an exception object</dfn>, given an <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#error-information\" id=\"ref-for-error-information⑦\">error information</a> <var>errorInfo</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>errorInfo</var> is a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information\" id=\"ref-for-domexception-error-information④\">DOMException error information</a>, then return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①⑤\">DOMException</a></code> with name given by <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-name\" id=\"ref-for-domexception-error-information-name①\">name</a>, using <var>errorInfo</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#domexception-error-information-details\" id=\"ref-for-domexception-error-information-details①\">details</a> to populate the message appropriately.</p>"
        },
        {
          "html": "Otherwise:",
          "rationale": "assert",
          "steps": [
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#assert\" id=\"ref-for-assert①⑨\">Assert</a>: <var>error</var> is a <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information\" id=\"ref-for-quota-exceeded-error-information③\">quota exceeded error information</a>.</p>"
            },
            {
              "html": "<p>Return a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror\" id=\"ref-for-quotaexceedederror②\">QuotaExceededError</a></code> whose <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-requested\" id=\"ref-for-quotaexceedederror-requested②\">requested</a> is <var>error</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-requested\" id=\"ref-for-quota-exceeded-error-information-requested①\">requested</a> and <a data-link-type=\"dfn\" href=\"https://whatpr.org/webidl/1465.html#quotaexceedederror-quota\" id=\"ref-for-quotaexceedederror-quota②\">quota</a> is <var>error</var>’s <a data-link-type=\"dfn\" href=\"https://webmachinelearning.github.io/writing-assistance-apis/#quota-exceeded-error-information-quota\" id=\"ref-for-quota-exceeded-error-information-quota①\">quota</a>.</p>"
            }
          ]
        }
      ]
    }
  ]
}