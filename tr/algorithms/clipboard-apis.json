{
  "spec": {
    "title": "Clipboard API and events",
    "url": "https://www.w3.org/TR/clipboard-apis/"
  },
  "algorithms": [
    {
      "html": "These are the steps to follow when triggering copy, cut or paste actions\n      through a scripting API:",
      "rationale": "execute",
      "steps": [
        {
          "html": "<p>Execute the corresponding action synchronously.</p>"
        },
        {
          "html": "<p>Use the action’s return value as the return value for the API call.</p>"
        }
      ]
    },
    {
      "name": "create a ClipboardItem object",
      "href": "https://www.w3.org/TR/clipboard-apis/#create-a-clipboarditem-object",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"create-a-clipboarditem-object\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">create a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem\" id=\"ref-for-clipboarditem③\">ClipboardItem</a></code> object</dfn><span style=\"position: relative; height: 0px;\"></span>, given a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-item\" id=\"ref-for-clipboard-item②⓪\">clipboard item</a> <var>clipboardItem</var> and a Realm <var>realm</var>, run these steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>clipboardItemObject</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#new\" id=\"ref-for-new\">new</a> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem\" id=\"ref-for-clipboarditem④\">ClipboardItem</a></code> with <var>realm</var>.</p>"
        },
        {
          "html": "<p>Set <var>clipboardItemObject</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-item\" id=\"ref-for-clipboard-item②①\">clipboard item</a> to <var>clipboardItem</var>.</p>"
        }
      ]
    },
    {
      "name": "ClipboardItem/ClipboardItem(items, options)",
      "href": "https://www.w3.org/TR/clipboard-apis/#dom-clipboarditem-clipboarditem",
      "html": "The <dfn class=\"dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"ClipboardItem\" data-dfn-type=\"constructor\" data-export=\"\" data-lt=\"ClipboardItem(items, options)|constructor(items, options)|ClipboardItem(items)|constructor(items)\" id=\"dom-clipboarditem-clipboarditem\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><code>new ClipboardItem(<var>items</var>, <var>options</var>)</code></dfn><span style=\"position: relative; height: 0px;\"></span> constructor steps are:",
      "rationale": "if",
      "steps": [
        {
          "html": "<p>If <var>items</var> is empty, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>If <var>options</var> is empty, then set options[\"presentationStyle\"] = \"unspecified\".</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item\">clipboard item</a> to a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-item\" id=\"ref-for-clipboard-item②②\">clipboard item</a>.</p>"
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item①\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#presentation-style\" id=\"ref-for-presentation-style\">presentation style</a> to <var>options</var>[\"<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboarditemoptions-presentationstyle\" id=\"ref-for-dom-clipboarditemoptions-presentationstyle\">presentationStyle</a></code>\"].</p>"
        },
        {
          "html": "<p>Let <var>types</var> be a list of <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑦\">DOMString</a></code>.</p>"
        },
        {
          "html": "For each (<var>key</var>, <var>value</var>) in <var>items</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parse-a-mime-type\" id=\"ref-for-parse-a-mime-type\">parsing a MIME type</a> given <var>key</var>.</p>"
            },
            {
              "html": "<p>If <var>mimeType</var> is failure, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror①\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>If <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item②\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#list-of-representations\" id=\"ref-for-list-of-representations①\">list of representations</a> <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-contain\" id=\"ref-for-list-contain\">contains</a> a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation\" id=\"ref-for-representation③\">representation</a> whose <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-mime-type\" id=\"ref-for-representation-mime-type④\">MIME type</a> is <var>mimeType</var>, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror②\">TypeError</a></code>.</p>"
            },
            {
              "html": "<p>Let <var>representation</var> be a new <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation\" id=\"ref-for-representation④\">representation</a>.</p>"
            },
            {
              "html": "<p>Set <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-mime-type\" id=\"ref-for-representation-mime-type⑤\">MIME type</a> to <var>mimeType</var>.</p>"
            },
            {
              "html": "<p>Set <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-data\" id=\"ref-for-representation-data\">data</a> to <var>value</var>.</p>"
            },
            {
              "html": "<p>Append <var>representation</var> to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this④\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item③\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#list-of-representations\" id=\"ref-for-list-of-representations②\">list of representations</a>.</p>"
            },
            {
              "html": "<p>Let <var>mimeTypeString</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#serialize-a-mime-type\" id=\"ref-for-serialize-a-mime-type\">serializing a MIME type</a> with <var>mimeType</var>.</p>"
            },
            {
              "html": "<p>Add <var>mimeTypeString</var> to <var>types</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Set <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑤\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-types-array\" id=\"ref-for-clipboarditem-types-array\">types array</a> to the result of running <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-create-frozen-array\" id=\"ref-for-dfn-create-frozen-array\">create a frozen array</a> from <var>types</var>.</p>"
        }
      ]
    },
    {
      "html": "This method must run the below steps:",
      "rationale": "let",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑧\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>mimeType</var> be the result of <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#parse-a-mime-type\" id=\"ref-for-parse-a-mime-type①\">parsing a MIME type</a> given <var>type</var>.</p>"
        },
        {
          "html": "<p>If <var>mimeType</var> is failure, then throw a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#exceptiondef-typeerror\" id=\"ref-for-exceptiondef-typeerror③\">TypeError</a></code>.</p>"
        },
        {
          "html": "<p>Let <var>itemTypeList</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this⑨\">this</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item⑤\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#list-of-representations\" id=\"ref-for-list-of-representations③\">list of representations</a>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise\">a new promise</a> in <var>realm</var>.</p>"
        },
        {
          "html": "For each <var>representation</var> in <var>itemTypeList</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-mime-type\" id=\"ref-for-representation-mime-type⑥\">MIME type</a> is <var>mimeType</var>, then:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>representationDataPromise</var> be the <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-data\" id=\"ref-for-representation-data①\">data</a>.</p>"
                },
                {
                  "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled\" id=\"ref-for-dfn-perform-steps-once-promise-is-settled\">React</a> to <var>representationDataPromise</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>representationDataPromise</var> was fulfilled with value <var>v</var>, then:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString⑧\">DOMString</a></code>, then follow the below steps:",
                          "rationale": "let",
                          "steps": [
                            {
                              "html": "<p>Let <var>dataAsBytes</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode\">UTF-8 encoding</a> <var>v</var>.</p>"
                            },
                            {
                              "html": "<p>Let <var>blobData</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob④\">Blob</a></code> created using <var>dataAsBytes</var> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type\">type</a></code> set to <var>mimeType</var>, <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#serialize-a-mime-type\" id=\"ref-for-serialize-a-mime-type①\">serialized</a>.</p>"
                            },
                            {
                              "html": "<p>Resolve <var>p</var> with <var>blobData</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob⑤\">Blob</a></code>, then follow the below steps:",
                          "rationale": "resolve",
                          "steps": [
                            {
                              "html": "<p>Resolve <var>p</var> with <var>v</var>.</p>"
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "html": "If <var>representationDataPromise</var> was rejected, then:",
                      "rationale": "reject",
                      "steps": [
                        {
                          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror\">\"NotFoundError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException\">DOMException</a></code> in <var>realm</var>.</p>"
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Return <var>p</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror①\">\"NotFoundError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException①\">DOMException</a></code> in <var>realm</var>.</p>"
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "clipboard-read",
      "href": "https://www.w3.org/TR/clipboard-apis/#dom-clipboard-read",
      "html": "<h4 class=\"heading settled dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Clipboard\" data-dfn-type=\"method\" data-export=\"\" data-level=\"7.3.1\" data-lt=\"read()\" id=\"dom-clipboard-read\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><span class=\"secno\">7.3.1. </span><span class=\"content\">read()</span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-read\" id=\"ref-for-dom-clipboard-read⑤\"></a></h4><span style=\"position: relative; height: 0px;\"></span>\n      The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-read\" id=\"ref-for-dom-clipboard-read④\">read()</a></code> method must run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⓪\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm①\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise①\">a new promise</a> in <var>realm</var>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>r</var> be the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#check-clipboard-read-permission\" id=\"ref-for-check-clipboard-read-permission\">check clipboard read permission</a>.</p>"
            },
            {
              "html": "If <var>r</var> is false, then:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task\">Queue a global task</a> on the <a data-link-type=\"dfn\">permission task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject②\">reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror\">\"NotAllowedError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException②\">DOMException</a></code> in <var>realm</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>data</var> be a copy of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#system-clipboard-data\" id=\"ref-for-system-clipboard-data③\">system clipboard data</a> represented as <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-items\" id=\"ref-for-clipboard-items①\">clipboard items</a>. For the MIME types defined in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#mandatory-data-types\" id=\"ref-for-mandatory-data-types①\">mandatory data types</a> list, <var>data</var> MAY be sanitized, but image/png format has unsanitized payload to preserve meta data.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task①\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-task-source\" id=\"ref-for-clipboard-task-source\">clipboard task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to perform the below steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>items</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence②\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem\" id=\"ref-for-clipboarditem⑨\">ClipboardItem</a></code>&gt;.</p>"
                },
                {
                  "html": "For each <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-item\" id=\"ref-for-clipboard-item②⑤\">clipboard item</a> <var>underlyingItem</var> of <var>data</var>:",
                  "rationale": "let",
                  "steps": [
                    {
                      "html": "<p>Let <var>item</var> be the result of running the steps of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#create-a-clipboarditem-object\" id=\"ref-for-create-a-clipboarditem-object\">create a ClipboardItem object</a> given <var>underlyingItem</var> and <var>realm</var>.</p>"
                    },
                    {
                      "html": "<p>Append <var>item</var> to <var>items</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Resolve <var>p</var> with <var>items</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "clipboard-readtext",
      "href": "https://www.w3.org/TR/clipboard-apis/#dom-clipboard-readtext",
      "html": "<h4 class=\"heading settled dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Clipboard\" data-dfn-type=\"method\" data-export=\"\" data-level=\"7.3.2\" data-lt=\"readText()\" id=\"dom-clipboard-readtext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><span class=\"secno\">7.3.2. </span><span class=\"content\">readText()</span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-readtext\" id=\"ref-for-dom-clipboard-readtext③\"></a></h4><span style=\"position: relative; height: 0px;\"></span>\n      The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-readtext\" id=\"ref-for-dom-clipboard-readtext②\">readText()</a></code> method must run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①①\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm②\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise②\">a new promise</a> in <var>realm</var>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel①\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>r</var> be the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#check-clipboard-read-permission\" id=\"ref-for-check-clipboard-read-permission①\">check clipboard read permission</a>.</p>"
            },
            {
              "html": "If <var>r</var> is false, then:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task②\">Queue a global task</a> on the <a data-link-type=\"dfn\">permission task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject③\">reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror①\">\"NotAllowedError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException③\">DOMException</a></code> in <var>realm</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<p>Let <var>data</var> be a copy of the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#system-clipboard-data\" id=\"ref-for-system-clipboard-data④\">system clipboard data</a> represented as <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-items\" id=\"ref-for-clipboard-items②\">clipboard items</a>. For the MIME types defined in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#mandatory-data-types\" id=\"ref-for-mandatory-data-types②\">mandatory data types</a> list, <var>data</var> MAY contain the sanitized copy of text/plain format.</p>"
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task③\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-task-source\" id=\"ref-for-clipboard-task-source①\">clipboard task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to perform the below steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>dataList</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence③\">sequence</a> of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-item\" id=\"ref-for-clipboard-item②⑥\">clipboard item</a>s.</p>"
                },
                {
                  "html": "<p>If <var>data</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size\">size</a> is greater than 1, then add <var>data</var>[0] to <var>dataList</var>.</p>"
                },
                {
                  "html": "<p>Let <var>itemTypeList</var> be <var>dataList</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item⑥\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#list-of-representations\" id=\"ref-for-list-of-representations④\">list of representations</a>.</p>"
                },
                {
                  "html": "For each <var>representation</var> in <var>itemTypeList</var>:",
                  "rationale": "if",
                  "steps": [
                    {
                      "html": "If <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-mime-type\" id=\"ref-for-representation-mime-type⑦\">MIME type</a> <a data-link-type=\"dfn\" href=\"https://mimesniff.spec.whatwg.org/#mime-type-essence\" id=\"ref-for-mime-type-essence\">essence</a> is \"text/plain\", then:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>representationDataPromise</var> be the <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-data\" id=\"ref-for-representation-data②\">data</a>.</p>"
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled\" id=\"ref-for-dfn-perform-steps-once-promise-is-settled①\">React</a> to <var>representationDataPromise</var>:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "If <var>representationDataPromise</var> was fulfilled with value <var>v</var>, then:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①①\">DOMString</a></code>, then follow the below steps:",
                                  "rationale": "resolve",
                                  "steps": [
                                    {
                                      "html": "<p>Resolve <var>p</var> with <var>v</var>.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob⑥\">Blob</a></code>, then follow the below steps:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>string</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode\">UTF-8 decoding</a> <var>v</var>’s underlying byte sequence.</p>"
                                    },
                                    {
                                      "html": "<p>Resolve <var>p</var> with <var>string</var>.</p>"
                                    }
                                  ]
                                }
                              ]
                            },
                            {
                              "html": "If <var>representationDataPromise</var> was rejected, then:",
                              "rationale": "reject",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject④\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror②\">\"NotFoundError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException④\">DOMException</a></code> in <var>realm</var>.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑤\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notfounderror\" id=\"ref-for-notfounderror③\">\"NotFoundError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑤\">DOMException</a></code> in <var>realm</var>.</p>"
                },
                {
                  "html": "<p>Return <var>p</var>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "clipboard-write",
      "href": "https://www.w3.org/TR/clipboard-apis/#dom-clipboard-write",
      "html": "<h4 class=\"heading settled dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Clipboard\" data-dfn-type=\"method\" data-export=\"\" data-level=\"7.3.3\" data-lt=\"write(data)\" id=\"dom-clipboard-write\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><span class=\"secno\">7.3.3. </span><span class=\"content\">write(<var>data</var>)</span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-write\" id=\"ref-for-dom-clipboard-write⑥\"></a></h4><span style=\"position: relative; height: 0px;\"></span>\n      The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-write\" id=\"ref-for-dom-clipboard-write⑤\">write(data)</a></code> method must run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①②\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm③\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise③\">a new promise</a> in <var>realm</var>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel②\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>r</var> be the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#check-clipboard-write-permission\" id=\"ref-for-check-clipboard-write-permission\">check clipboard write permission</a>.</p>"
            },
            {
              "html": "If <var>r</var> is false, then:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task④\">Queue a global task</a> on the <a data-link-type=\"dfn\">permission task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑥\">reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror②\">\"NotAllowedError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑥\">DOMException</a></code> in <var>realm</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑤\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-task-source\" id=\"ref-for-clipboard-task-source②\">clipboard task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to perform the below steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>itemList</var> and <var>cleanItemList</var> be an empty <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence④\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob⑦\">Blob</a></code>&gt;.</p>"
                },
                {
                  "html": "<p>Let <var>dataList</var> be a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑤\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem\" id=\"ref-for-clipboarditem①⓪\">ClipboardItem</a></code>&gt;.</p>"
                },
                {
                  "html": "<p>If <var>data</var>’s <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#list-size\" id=\"ref-for-list-size①\">size</a> is greater than 1, and the current operating system does not support multiple native clipboard items on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#system-clipboard\" id=\"ref-for-system-clipboard①③\">system clipboard</a>, then add <var>data</var>[0] to <var>dataList</var>, else, set <var>dataList</var> to <var>data</var>.</p>"
                },
                {
                  "html": "For each <var>clipboardItem</var> in <var>dataList</var>:",
                  "rationale": "for",
                  "steps": [
                    {
                      "html": "For each <var>representation</var> in <var>clipboardItem</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item⑦\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#list-of-representations\" id=\"ref-for-list-of-representations⑤\">list of representations</a>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>representationDataPromise</var> be the <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-data\" id=\"ref-for-representation-data③\">data</a>.</p>"
                        },
                        {
                          "html": "<a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#dfn-perform-steps-once-promise-is-settled\" id=\"ref-for-dfn-perform-steps-once-promise-is-settled②\">React</a> to <var>representationDataPromise</var>:",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "If <var>representationDataPromise</var> was fulfilled with value <var>v</var>, then:",
                              "rationale": "if",
                              "steps": [
                                {
                                  "html": "If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMString\" id=\"ref-for-idl-DOMString①②\">DOMString</a></code>, then follow the below steps:",
                                  "rationale": "let",
                                  "steps": [
                                    {
                                      "html": "<p>Let <var>dataAsBytes</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode①\">UTF-8 encoding</a> <var>v</var>.</p>"
                                    },
                                    {
                                      "html": "<p>Let <var>blobData</var> be a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob⑧\">Blob</a></code> created using <var>dataAsBytes</var> with its <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type①\">type</a></code> set to <var>representation</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#representation-mime-type\" id=\"ref-for-representation-mime-type⑧\">MIME type</a>.</p>"
                                    },
                                    {
                                      "html": "<p>Add <var>blobData</var> to <var>itemList</var>.</p>"
                                    }
                                  ]
                                },
                                {
                                  "html": "<p>If <var>v</var> is a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob⑨\">Blob</a></code>, then add <var>v</var> to <var>itemList</var>.</p>"
                                }
                              ]
                            },
                            {
                              "html": "If <var>representationDataPromise</var> was rejected, then:",
                              "rationale": "reject",
                              "steps": [
                                {
                                  "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑦\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror③\">\"NotAllowedError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑦\">DOMException</a></code> in <var>realm</var>.</p>"
                                },
                                {
                                  "html": "<p>Abort these steps.</p>"
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    },
                    {
                      "html": "For each <var>blob</var> in <var>itemList</var>:",
                      "rationale": "let",
                      "steps": [
                        {
                          "html": "<p>Let <var>type</var> be the <var>blob</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type②\">type</a></code>.</p>"
                        },
                        {
                          "html": "<p>If <var>type</var> is not in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#mandatory-data-types\" id=\"ref-for-mandatory-data-types③\">mandatory data types</a> list, then <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑧\">reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror④\">\"NotAllowedError\"</a></code> <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#idl-DOMException\" id=\"ref-for-idl-DOMException⑧\">DOMException</a></code> in <var>realm</var> and abort these steps.</p>"
                        },
                        {
                          "html": "<p>Let <var>cleanItem</var> be an optionally sanitized copy of <var>blob</var>.</p>"
                        },
                        {
                          "html": "If sanitization was attempted and was not successfully completed, then follow the below steps:",
                          "rationale": "reject",
                          "steps": [
                            {
                              "html": "<p><a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject⑨\">Reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑤\">\"NotAllowedError\"</a></code> DOMException in <var>realm</var>.</p>"
                            },
                            {
                              "html": "<p>Abort these steps.</p>"
                            }
                          ]
                        },
                        {
                          "html": "<p>Append <var>cleanItem</var> to <var>cleanItemList</var>.</p>"
                        }
                      ]
                    },
                    {
                      "html": "<p>Let <var>option</var> be <var>clipboardItem</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item⑧\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#presentation-style\" id=\"ref-for-presentation-style②\">presentation style</a>.</p>"
                    },
                    {
                      "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#write-blobs-and-option-to-the-clipboard\" id=\"ref-for-write-blobs-and-option-to-the-clipboard\">Write blobs and option to the clipboard</a> with <var>cleanItemList</var> and <var>option</var>.</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Resolve <var>p</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "clipboard-writetext",
      "href": "https://www.w3.org/TR/clipboard-apis/#dom-clipboard-writetext",
      "html": "<h4 class=\"heading settled dfn-paneled idl-code has-dfn-panel\" data-dfn-for=\"Clipboard\" data-dfn-type=\"method\" data-export=\"\" data-level=\"7.3.4\" data-lt=\"writeText(data)\" id=\"dom-clipboard-writetext\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\"><span class=\"secno\">7.3.4. </span><span class=\"content\">writeText(<var>data</var>)</span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-writetext\" id=\"ref-for-dom-clipboard-writetext②\"></a></h4><span style=\"position: relative; height: 0px;\"></span>\n      The <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboard-writetext\" id=\"ref-for-dom-clipboard-writetext①\">writeText(data)</a></code> method must run these steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>realm</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①③\">this</a>'s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-realm\" id=\"ref-for-concept-relevant-realm④\">relevant realm</a>.</p>"
        },
        {
          "html": "<p>Let <var>p</var> be <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#a-new-promise\" id=\"ref-for-a-new-promise④\">a new promise</a> in <var>realm</var>.</p>"
        },
        {
          "html": "Run the following steps <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/infrastructure.html#in-parallel\" id=\"ref-for-in-parallel③\">in parallel</a>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>r</var> be the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#check-clipboard-write-permission\" id=\"ref-for-check-clipboard-write-permission①\">check clipboard write permission</a>.</p>"
            },
            {
              "html": "If <var>r</var> is false, then:",
              "rationale": "queue",
              "steps": [
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑥\">Queue a global task</a> on the <a data-link-type=\"dfn\">permission task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#reject\" id=\"ref-for-reject①⓪\">reject</a> <var>p</var> with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://webidl.spec.whatwg.org/#notallowederror\" id=\"ref-for-notallowederror⑥\">\"NotAllowedError\"</a></code> DOMException in <var>realm</var>.</p>"
                },
                {
                  "html": "<p>Abort these steps.</p>"
                }
              ]
            },
            {
              "html": "<a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-global-task\" id=\"ref-for-queue-a-global-task⑦\">Queue a global task</a> on the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboard-task-source\" id=\"ref-for-clipboard-task-source③\">clipboard task source</a>, given <var>realm</var>’s <a data-link-type=\"dfn\">global object</a>, to perform the below steps:",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>itemList</var> be an empty <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑥\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob①⓪\">Blob</a></code>&gt;.</p>"
                },
                {
                  "html": "<p>Let <var>textBlob</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob①①\">Blob</a></code> created with: <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type③\">type</a></code> attribute set to \"<code>text/plain;charset=utf-8</code>\", and\nits underlying byte sequence set to the <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-encode\" id=\"ref-for-utf-8-encode②\">UTF-8 encoding</a> of <var>data</var>.</p>"
                },
                {
                  "html": "<p>Add <var>textBlob</var> to <var>itemList</var>.</p>"
                },
                {
                  "html": "<p>Let <var>option</var> be set to \"unspecified\".</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#write-blobs-and-option-to-the-clipboard\" id=\"ref-for-write-blobs-and-option-to-the-clipboard①\">Write blobs and option to the clipboard</a> with <var>itemList</var> and <var>option</var>.</p>"
                },
                {
                  "html": "<p>Resolve <var>p</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Return <var>p</var>.</p>"
        }
      ]
    },
    {
      "name": "script-may-access-clipboard",
      "href": "https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard",
      "html": "The <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"script-may-access-clipboard\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">script-may-access-clipboard</dfn><span style=\"position: relative; height: 0px;\"></span> flag is set as follows:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If action is <em>copy</em> or <em>cut</em> and the script thread\nis <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#allowed-to-modify-the-clipboard\" id=\"ref-for-allowed-to-modify-the-clipboard\">allowed to modify the clipboard</a>, then",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set the action’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard\" id=\"ref-for-script-may-access-clipboard①\">script-may-access-clipboard</a> flag</p>"
            }
          ]
        },
        {
          "html": "If action is <em>paste</em> and the script thread is <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#allowed-to-read-from-clipboard\" id=\"ref-for-allowed-to-read-from-clipboard\">allowed to\nread from clipboard</a>, then",
          "rationale": "set",
          "steps": [
            {
              "html": "<p>Set the action’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard\" id=\"ref-for-script-may-access-clipboard②\">script-may-access-clipboard</a> flag.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "clipboard-copy-action",
      "html": "The copy action consists of the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-triggered\" id=\"ref-for-script-triggered②\">script-triggered</a> flag is set, then",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard\" id=\"ref-for-script-may-access-clipboard③\">script-may-access-clipboard</a> flag is unset, then",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false from the copy action, terminate this algorithm</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event③\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-copy\" id=\"ref-for-eventdef-documentandelementeventhandlers-copy⑦\">copy</a></code></p>"
        },
        {
          "html": "If the event was not canceled, then",
          "rationale": "copy",
          "steps": [
            {
              "html": "<p>Copy the selected contents, if any, to the clipboard.\nImplementations <em>should</em> create alternate text/html and\ntext/plain clipboard formats when content in a web page is selected.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event④\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-clipboardchange\" id=\"ref-for-eventdef-documentandelementeventhandlers-clipboardchange③\">clipboardchange</a></code></p>"
            }
          ]
        },
        {
          "html": "Else, if the event was canceled, then",
          "rationale": "call",
          "steps": [
            {
              "html": "<p>Call the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#write-content-to-the-clipboard\" id=\"ref-for-write-content-to-the-clipboard\">write content to the clipboard</a> algorithm,\npassing on the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist①\">DataTransferItemList</a></code> list <em>items</em>,\na <em>clear-was-called</em> flag and a <em>types-to-clear</em> list.</p>"
            }
          ]
        },
        {
          "html": "<p>Return true from the copy action</p>"
        }
      ]
    },
    {
      "name": "clipboard-cut-action",
      "html": "The cut action consists of the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-triggered\" id=\"ref-for-script-triggered③\">script-triggered</a> flag is set, then",
          "rationale": "if",
          "steps": [
            {
              "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard\" id=\"ref-for-script-may-access-clipboard④\">script-may-access-clipboard</a> flag is unset, then",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false from the cut action, terminate this algorithm</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event⑤\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-cut\" id=\"ref-for-eventdef-documentandelementeventhandlers-cut①⓪\">cut</a></code></p>"
        },
        {
          "html": "If the event was not canceled, then",
          "rationale": "if",
          "steps": [
            {
              "html": "If there is a selection in an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#editable-context\" id=\"ref-for-editable-context④\">editable context</a> where\ncutting is enabled, then",
              "rationale": "copy",
              "steps": [
                {
                  "html": "<p>Copy the selected contents, if any, to the clipboard.\nImplementations <em>should</em> create alternate\ntext/html and text/plain clipboard formats when content\nin a web page is selected.</p>"
                },
                {
                  "html": "<p>Remove the contents of the selection from the document\nand collapse the selection.</p>"
                },
                {
                  "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event⑥\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-clipboardchange\" id=\"ref-for-eventdef-documentandelementeventhandlers-clipboardchange④\">clipboardchange</a></code></p>"
                },
                {
                  "html": "<p>Queue tasks to fire any events that should fire due to the\nmodification, see <a href=\"https://www.w3.org/TR/clipboard-apis/#integration-with-other-scripts-and-events\">§ 5.3 Integration with other scripts and events</a> for details.</p>"
                }
              ]
            },
            {
              "html": "Else, if there is no selection or the context is not editable, then",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Else, if the event was canceled, then",
          "rationale": "call",
          "steps": [
            {
              "html": "<p>Call the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#write-content-to-the-clipboard\" id=\"ref-for-write-content-to-the-clipboard①\">write content to the clipboard</a> algorithm,\npassing on the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist②\">DataTransferItemList</a></code> list <em>items</em>,\na <em>clear-was-called</em> flag and a <em>types-to-clear</em> list.</p>"
            },
            {
              "html": "<p><a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event⑦\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-clipboardchange\" id=\"ref-for-eventdef-documentandelementeventhandlers-clipboardchange⑤\">clipboardchange</a></code></p>"
            }
          ]
        },
        {
          "html": "<p>Return true from the cut action</p>"
        }
      ]
    },
    {
      "name": "clipboard-paste-action",
      "html": "The paste action consists of the following steps:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-triggered\" id=\"ref-for-script-triggered④\">script-triggered</a> flag is set, then",
          "rationale": "if",
          "steps": [
            {
              "html": "If <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#script-may-access-clipboard\" id=\"ref-for-script-may-access-clipboard⑥\">script-may-access-clipboard</a> is unset, then",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false from the paste action, terminate this algorithm</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p><a href=\"https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event\" id=\"ref-for-fire-a-clipboard-event⑧\">Fire a clipboard event</a> named <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#eventdef-documentandelementeventhandlers-paste\" id=\"ref-for-eventdef-documentandelementeventhandlers-paste⑨\">paste</a></code></p>"
        },
        {
          "html": "If the event was not canceled, then",
          "rationale": "if",
          "steps": [
            {
              "html": "If there is a selection or cursor in an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#editable-context\" id=\"ref-for-editable-context⑤\">editable context</a> where pasting is enabled, then",
              "rationale": "insert",
              "steps": [
                {
                  "html": "<p>Insert the most suitable content found on the clipboard,\nif any, into the context.</p>"
                },
                {
                  "html": "<p>Queue tasks to fire any events that should fire due to\nthe modification, see <a href=\"https://www.w3.org/TR/clipboard-apis/#integration-with-other-scripts-and-events\">§ 5.3 Integration with other scripts and events</a> for details.</p>"
                }
              ]
            },
            {
              "html": "Else",
              "rationale": "return",
              "steps": [
                {
                  "html": "<p>Return false</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Else, if the event was canceled",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return false</p>"
            }
          ]
        },
        {
          "html": "<p>Return true from the action</p>"
        }
      ]
    },
    {
      "name": "clipboard-read-permission",
      "href": "https://www.w3.org/TR/clipboard-apis/#check-clipboard-read-permission",
      "html": "<h4 class=\"heading settled\" data-level=\"9.1.1\" id=\"h-clipboard-read-permission\"><span class=\"secno\">9.1.1. </span><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-clipboard-read-permission\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check clipboard read permission</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#h-clipboard-read-permission\"></a></h4>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>hasGesture</var> be true if the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global\">relevant global object</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①④\">this</a> has <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation\">transient activation</a>, false otherwise.</p>"
        },
        {
          "html": "If <var>hasGesture</var> then,",
          "rationale": "return",
          "steps": [
            {
              "html": "<p>Return true if the current script is running as a result of user\ninteraction with a \"Paste\" element created by the user agent or operating\nsystem.</p>"
            }
          ]
        },
        {
          "html": "<p>Return false.</p>"
        }
      ]
    },
    {
      "name": "clipboard-write-permission",
      "href": "https://www.w3.org/TR/clipboard-apis/#check-clipboard-write-permission",
      "html": "<h4 class=\"heading settled\" data-level=\"9.2.1\" id=\"h-clipboard-write-permission\"><span class=\"secno\">9.2.1. </span><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"check-clipboard-write-permission\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">check clipboard write permission</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#h-clipboard-write-permission\"></a></h4>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>writeWithoutGesture</var> be the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-permission-state\" id=\"ref-for-dfn-permission-state\">permission state</a> of the <code>{ name: \"clipboard-write\", allowWithoutGesture: true }</code> permission.</p>"
        },
        {
          "html": "<p>If <var>writeWithoutGesture</var> is <a data-link-type=\"dfn\" href=\"https://w3c.github.io/permissions/#dom-permissionstate-granted\" id=\"ref-for-dom-permissionstate-granted\">granted</a>, then return true.</p>"
        },
        {
          "html": "<p>Let <var>hasGesture</var> be true if the <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/webappapis.html#concept-relevant-global\" id=\"ref-for-concept-relevant-global①\">relevant global object</a> of <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#this\" id=\"ref-for-this①⑤\">this</a> has <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#transient-activation\" id=\"ref-for-transient-activation①\">transient activation</a>, false otherwise.</p>"
        },
        {
          "html": "If <var>hasGesture</var> then,",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>systemCopy</var> be true if the current script is running as a result of user\ninteraction with a \"cut\" or \"copy\" element created by the user agent or operating\nsystem.</p>"
            },
            {
              "html": "<p>If <var>systemCopy</var> is true, then return true.</p>"
            },
            {
              "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-request-permission-to-use\" id=\"ref-for-dfn-request-permission-to-use\">request permission to use</a> the <code>{ name: \"clipboard-write\", allowWithoutGesture: false }</code> permission.</p>"
            }
          ]
        },
        {
          "html": "<p>Return the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/permissions/#dfn-request-permission-to-use\" id=\"ref-for-dfn-request-permission-to-use①\">request permission to use</a> the <code>{ name: \"clipboard-write\", allowWithoutGesture: true }</code> permission.</p>"
        }
      ]
    },
    {
      "name": "write-content-to-clipboard",
      "href": "https://www.w3.org/TR/clipboard-apis/#write-content-to-the-clipboard",
      "html": "<h3 class=\"heading settled\" id=\"to-write-content-to-clipboard\"><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"write-content-to-the-clipboard\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">write content to the clipboard</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#to-write-content-to-clipboard\"></a></h3>\n    <dl>\n     <dt data-md=\"\">Input\n     </dt><dd data-md=\"\">\n      <p><var>items</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist④\">DataTransferItemList</a></code> list of items to write</p>\n     </dd><dd data-md=\"\">\n      <p><var>clear-was-called</var>, a boolean</p>\n     </dd><dd data-md=\"\">\n      <p><var>types-to-clear</var>, a list</p>\n     </dd><dt data-md=\"\">Output\n     </dt><dd data-md=\"\">\n      <p>None</p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "If the <var>items</var> list is not empty, then",
          "rationale": "clear",
          "steps": [
            {
              "html": "<p>Clear the clipboard</p>"
            },
            {
              "html": "For each part in the list,",
              "rationale": "if",
              "steps": [
                {
                  "html": "If data type is <i>text/plain</i>, then",
                  "rationale": "ensure",
                  "steps": [
                    {
                      "html": "<p>Ensure encoding is correct per OS and locale conventions</p>"
                    },
                    {
                      "html": "<p>Normalize line endings according to platform conventions</p>"
                    },
                    {
                      "html": "<p>Place text on clipboard with the appropriate OS clipboard\nformat description</p>"
                    }
                  ]
                },
                {
                  "html": "Else, if data is of a type listed in the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#mandatory-data-types\" id=\"ref-for-mandatory-data-types④\">mandatory data types</a> list, then",
                  "rationale": "place",
                  "steps": [
                    {
                      "html": "<p>Place part on clipboard with the appropriate OS clipboard\nformat description</p>"
                    }
                  ]
                },
                {
                  "html": "<p>Else</p>",
                  "ignored": [
                    "This is left to the implementation..."
                  ]
                }
              ]
            }
          ]
        },
        {
          "html": "Else, the <var>items</var> list is empty. Follow these steps to determine\nwhether to clear the clipboard:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the list of items is empty and the <var>clear-was-called</var> flag is <i>true</i>, then",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <var>types-to-clear</var> list is empty, then",
                  "rationale": "clear",
                  "steps": [
                    {
                      "html": "<p>Clear the clipboard</p>"
                    }
                  ]
                },
                {
                  "html": "Else",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p>Remove types in the <var>types-to-clear</var> list from the\nclipboard in an operating system and implementation-specific\nway</p>"
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "write-blobs-to-clipboard",
      "href": "https://www.w3.org/TR/clipboard-apis/#write-blobs-and-option-to-the-clipboard",
      "html": "<h3 class=\"heading settled\" id=\"to-write-blobs-to-clipboard\"><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"write-blobs-and-option-to-the-clipboard\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">write blobs and option to the clipboard</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#to-write-blobs-to-clipboard\"></a></h3>\n    <dl>\n     <dt data-md=\"\">Input\n     </dt><dd data-md=\"\">\n      <p><var>items</var>, a <a data-link-type=\"dfn\" href=\"https://webidl.spec.whatwg.org/#idl-sequence\" id=\"ref-for-idl-sequence⑦\">sequence</a>&lt;<code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-Blob\" id=\"ref-for-dfn-Blob①②\">Blob</a></code>&gt;</p>\n     </dd><dd data-md=\"\">\n      <p><var>presentationStyle</var>, a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboarditem-clipboard-item\" id=\"ref-for-clipboarditem-clipboard-item⑨\">clipboard item</a>'s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#presentation-style\" id=\"ref-for-presentation-style③\">presentation style</a></p>\n     </dd><dt data-md=\"\">Output\n     </dt><dd data-md=\"\">\n      <p>None</p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "For each <var>item</var> in <var>items</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>formatString</var> be the result of running <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#os-specific-well-known-format\" id=\"ref-for-os-specific-well-known-format\">os specific well-known format</a> given <var>item</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type④\">type</a></code>.</p>"
            },
            {
              "html": "<p>If <var>formatString</var> is empty then abort these steps.</p>"
            },
            {
              "html": "<p>Let <var>payload</var> be the result of <a data-link-type=\"dfn\" href=\"https://encoding.spec.whatwg.org/#utf-8-decode\" id=\"ref-for-utf-8-decode①\">UTF-8 decoding</a> <var>item</var>’s underlying byte sequence.</p>"
            },
            {
              "html": "<p>Insert <var>payload</var> and <var>presentationStyle</var> into the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#system-clipboard\" id=\"ref-for-system-clipboard①④\">system clipboard</a> using <var>formatString</var> as the native clipboard format.</p>"
            }
          ]
        }
      ]
    },
    {
      "name": "os-specific-well-known-format",
      "href": "https://www.w3.org/TR/clipboard-apis/#os-specific-well-known-format",
      "html": "<h3 class=\"heading settled\" id=\"to-os-specific-well-known-format\"><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"os-specific-well-known-format\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">os specific well-known format</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#to-os-specific-well-known-format\"></a></h3>\n    <dl>\n     <dt data-md=\"\">Input\n     </dt><dd data-md=\"\">\n      <p><var>mimeType</var>, a <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-type\" id=\"ref-for-dfn-type⑤\">type</a></code></p>\n     </dd><dt data-md=\"\">Output\n     </dt><dd data-md=\"\">\n      <p><var>wellKnownFormat</var>, a platform specific string type. On Mac it’s NSPasteboardType, on Windows it’s LPCWSTR and Linux it’s a const char*.</p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>wellKnownFormat</var> be a string.</p>"
        },
        {
          "html": "On Windows, follow the convention described below:",
          "rationale": "assign",
          "steps": [
            {
              "html": "<p>Assign CF_UNICODETEXT to <var>wellKnownFormat</var>.</p>"
            },
            {
              "html": "<p>Return <var>wellKnownFormat</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "On MacOS, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign NSPasteboardTypeString to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            },
            {
              "html": "On Linux, ChromeOS, and Android, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign \"text/plain\" to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "On Windows, follow the convention described below:",
          "rationale": "assign",
          "steps": [
            {
              "html": "<p>Assign CF_HTML to <var>wellKnownFormat</var>.</p>"
            },
            {
              "html": "<p>Return <var>wellKnownFormat</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "On MacOS, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign NSHTMLPboardType to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            },
            {
              "html": "On Linux, ChromeOS, and Android, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign \"text/html\" to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "On Windows, follow the convention described below:",
          "rationale": "assign",
          "steps": [
            {
              "html": "<p>Assign \"PNG\" to <var>wellKnownFormat</var>.</p>"
            },
            {
              "html": "<p>Return <var>wellKnownFormat</var>.</p>"
            }
          ],
          "additional": [
            {
              "html": "On MacOS, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign NSPasteboardTypePNG to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            },
            {
              "html": "On Linux, ChromeOS, and Android, follow the convention described below:",
              "rationale": "assign",
              "steps": [
                {
                  "html": "<p>Assign \"image/png\" to <var>wellKnownFormat</var>.</p>"
                },
                {
                  "html": "<p>Return <var>wellKnownFormat</var>.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Else</p>",
          "ignored": [
            "This is left to the implementation..."
          ]
        }
      ]
    },
    {
      "name": "algo-fire-a-clipboard-event",
      "href": "https://www.w3.org/TR/clipboard-apis/#fire-a-clipboard-event",
      "html": "<h3 class=\"heading settled\" id=\"to-fire-a-clipboard-event\"><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"fire-a-clipboard-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">fire a clipboard event</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#to-fire-a-clipboard-event\"></a></h3>\n    <dl>\n     <dt data-md=\"\">Input\n     </dt><dd data-md=\"\">\n      <p><var>e</var>, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#clipboardevent\" id=\"ref-for-clipboardevent④\">ClipboardEvent</a></code> to fire</p>\n     </dd><dt data-md=\"\">Output\n     </dt><dd data-md=\"\">\n      <p>None</p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>clear-was-called</var> be <em>false</em></p>"
        },
        {
          "html": "<p>Let <var>types-to-clear</var> be an empty list</p>"
        },
        {
          "html": "<p>Let <var>clipboard-event-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransfer\" id=\"ref-for-datatransfer①⓪\">DataTransfer</a></code> object with an empty <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items②\">items</a></code> list.</p>"
        },
        {
          "html": "<p>Let <var>clipboard-entry</var> be the sequence number of the current\nclipboard content, or null if the OS clipboard does not support\nsequence numbers</p>"
        },
        {
          "html": "<p>Let <var>trusted</var> be <em>true</em> if the event is generated by the\nuser agent, <em>false</em> otherwise</p>"
        },
        {
          "html": "Let <var>target</var> be set as follows:",
          "rationale": "if",
          "steps": [
            {
              "html": "If the context is editable, then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>target</var> to be the element that contains the\nstart of the visible selection or cursor in document order,\nor <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#the-body-element-2\" id=\"ref-for-the-body-element-2\">the body element</a> if there is no visible selection or cursor.</p>"
                }
              ]
            },
            {
              "html": "Else, if the context is not editable, then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>target</var> to the focused node, or <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/dom.html#the-body-element-2\" id=\"ref-for-the-body-element-2①\">the body element</a> if no node\nhas focus.</p>"
                }
              ]
            }
          ]
        },
        {
          "html": "Process the event as follows:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>e</var> is \"paste\", then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set the <var>clipboard-event-data</var>’s\ninternal <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-store-mode\" id=\"ref-for-drag-data-store-mode①\">drag data store mode</a> flag to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#concept-dnd-ro\" id=\"ref-for-concept-dnd-ro①\">read-only</a>.</p>"
                },
                {
                  "html": "If <var>trusted</var> is <em>true</em>, or the\nimplementation is configured to give script-generated events\nread access to the OS clipboard",
                  "rationale": "for",
                  "steps": [
                    {
                      "html": "For each <var>clipboard-part</var> on the OS clipboard, carry out these steps:",
                      "rationale": "if",
                      "steps": [
                        {
                          "html": "If <var>clipboard-part</var> contains plain text, then",
                          "rationale": "ensure",
                          "steps": [
                            {
                              "html": "<p>Ensure the text is in the encoding the\nscripting engine uses internally</p>"
                            },
                            {
                              "html": "<p>Let <var>new-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitem\" id=\"ref-for-datatransferitem\">DataTransferItem</a></code> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-kind\" id=\"ref-for-drag-data-item-kind\">drag data item kind</a> set to <em>string</em> and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string\">drag data item type string</a> set to <em>text/plain</em>.</p>"
                            },
                            {
                              "html": "<p>Set <var>new-data</var>’s data to the plain text.</p>"
                            },
                            {
                              "html": "<p>Add <var>new-data</var> to <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items③\">items</a></code></p>"
                            }
                          ]
                        },
                        {
                          "html": "If <var>clipboard-part</var> represents file\nreferences, then for each file reference:",
                          "rationale": "determine",
                          "steps": [
                            {
                              "html": "<p>Determine MIME type of referenced file</p>"
                            },
                            {
                              "html": "<p>Let <var>new-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitem\" id=\"ref-for-datatransferitem①\">DataTransferItem</a></code> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-kind\" id=\"ref-for-drag-data-item-kind①\">drag data item kind</a> set to <em>file</em> and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string①\">drag data item type string</a> set to the\ncorresponding MIME type, or <code>application/octet-stream</code> if the\nfile’s type is unknown.</p>"
                            },
                            {
                              "html": "<p>Set <var>new-data</var>’s data to the file reference data.</p>"
                            },
                            {
                              "html": "<p>Add <var>new-data</var> to <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items④\">items</a></code></p>"
                            }
                          ]
                        },
                        {
                          "html": "If <var>clipboard-part</var> contains HTML- or\nXHTML-formatted text, according to the operating\nsystem’s convention for describing such clipboard\nformats, then",
                          "rationale": "if",
                          "steps": [
                            {
                              "html": "<p>If the implementation supports pasting HTML, then\nthe implementation <em>must</em> process the\nmarkup by calling <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#process-an-html-paste-event\" id=\"ref-for-process-an-html-paste-event\">process an html paste event</a> with <var>clipboard-part</var> and <var>clipboard-event-data</var>.</p>"
                            }
                          ]
                        },
                        {
                          "html": "If <var>clipboard-part</var> contains data in\nanother supported binary or text-based format (see <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/clipboard-apis/#mandatory-data-types\" id=\"ref-for-mandatory-data-types⑦\">mandatory data types</a>), then",
                          "rationale": "determine",
                          "steps": [
                            {
                              "html": "<p>Determine the MIME type of the data</p>"
                            },
                            {
                              "html": "<p>Let <var>new-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitem\" id=\"ref-for-datatransferitem②\">DataTransferItem</a></code> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-kind\" id=\"ref-for-drag-data-item-kind②\">drag data item kind</a> set to <em>file</em>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string②\">drag data item type string</a> set to the corresponding MIME type</p>"
                            },
                            {
                              "html": "<p>Set <var>new-data</var>’s data to be the binary or text-based data.</p>"
                            },
                            {
                              "html": "<p>Add <var>new-data</var> to <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items⑤\">items</a></code></p>"
                            }
                          ]
                        }
                      ]
                    }
                  ]
                },
                {
                  "html": "<p>Update <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-files\" id=\"ref-for-dom-datatransfer-files②\">files</a></code> property to match\nentries in <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items⑥\">items</a></code>.</p>"
                },
                {
                  "html": "<p>Update <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-types\" id=\"ref-for-dom-datatransfer-types\">types</a></code> property to match\nentries in <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items⑦\">items</a></code>.</p>"
                }
              ]
            },
            {
              "html": "If <var>e</var> is \"copy\" or \"cut\", then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set the associated <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransfer\" id=\"ref-for-datatransfer①①\">DataTransfer</a></code> object’s internal <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-store-mode\" id=\"ref-for-drag-data-store-mode②\">drag data store mode</a> flag to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#concept-dnd-rw\" id=\"ref-for-concept-dnd-rw\">read/write</a></p>"
                }
              ]
            }
          ]
        },
        {
          "html": "<p>Set <var>e</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/clipboard-apis/#dom-clipboardevent-clipboarddata\" id=\"ref-for-dom-clipboardevent-clipboarddata④\">clipboardData</a></code> to <var>clipboard-event-data</var>.</p>"
        },
        {
          "html": "<p>Set <var>e</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-istrusted\" id=\"ref-for-dom-event-istrusted\">isTrusted</a></code> to <var>trusted</var>.</p>"
        },
        {
          "html": "<p>Set <var>e</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://dom.spec.whatwg.org/#dom-event-composed\" id=\"ref-for-dom-event-composed\">composed</a></code> to true.</p>"
        },
        {
          "html": "Implementation requirements for access to data during event\ndispatch are defined in <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/clipboard-apis/#biblio-html\" title=\"HTML Standard\">[HTML]</a>. Some additional clipboard\nevent-specific processing rules are given below:",
          "rationale": "if",
          "steps": [
            {
              "html": "If a script calls <a data-link-type=\"functionish\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-cleardata\" id=\"ref-for-dom-datatransfer-cleardata\">clearData()</a> or <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransferitemlist-clear\" id=\"ref-for-dom-datatransferitemlist-clear\">clear()</a></code> and the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransfer\" id=\"ref-for-datatransfer①②\">DataTransfer</a></code> object’s internal <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-store-mode\" id=\"ref-for-drag-data-store-mode③\">drag data store mode</a> flag is <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#concept-dnd-rw\" id=\"ref-for-concept-dnd-rw①\">read/write</a>, then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set the <var>clear-was-called</var> flag to true. If an\nargument is given, add the argument to the <var>types-to-clear</var> list.</p>"
                }
              ]
            },
            {
              "html": "If a script calls <a data-link-type=\"functionish\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-setdata\" id=\"ref-for-dom-datatransfer-setdata③\">setData()</a> or modifies items and the <var>clear-was-called</var> flag is true, then",
              "rationale": "if",
              "steps": [
                {
                  "html": "If the <var>types-to-clear</var> list is empty, then",
                  "rationale": "set",
                  "steps": [
                    {
                      "html": "<p>Set the <var>clear-was-called</var> flag to false, then</p>"
                    }
                  ]
                },
                {
                  "html": "Else, if <a data-link-type=\"functionish\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-setdata\" id=\"ref-for-dom-datatransfer-setdata④\">setData()</a>’s <code>type</code> argument or\nthe new item’s <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string③\">drag data item type string</a> is\nfound in the <var>types-to-clear</var> list, then",
                  "rationale": "remove",
                  "steps": [
                    {
                      "html": "<p>Remove it from the list. If the list is now empty,\nset the <var>clear-was-called</var> flag to false.</p>"
                    }
                  ]
                }
              ]
            },
            {
              "html": "If a script calls <a data-link-type=\"functionish\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-getdata\" id=\"ref-for-dom-datatransfer-getdata\">getData()</a> or accesses items in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist⑤\">DataTransferItemList</a></code> and <var>clipboard-entry</var> is\nset, then",
              "rationale": "check",
              "steps": [
                {
                  "html": "<p>Check that the clipboard data’s sequence number matches <var>clipboard-entry</var>. If the clipboard no longer\ncontains the same entry, set the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist⑥\">DataTransferItemList</a></code> object’s internal <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-store-mode\" id=\"ref-for-drag-data-store-mode④\">drag data store mode</a> to <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#concept-dnd-p\" id=\"ref-for-concept-dnd-p\">protected</a>.</p>"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "process-an-html-paste-event",
      "href": "https://www.w3.org/TR/clipboard-apis/#process-an-html-paste-event",
      "html": "<h3 class=\"heading settled\" id=\"to-process-html-paste-event\"><span class=\"content\"><dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"process-an-html-paste-event\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">process an HTML paste event</dfn><span style=\"position: relative; height: 0px;\"></span></span><a class=\"self-link\" href=\"https://www.w3.org/TR/clipboard-apis/#to-process-html-paste-event\"></a></h3>\n    <dl>\n     <dt data-md=\"\">Input\n     </dt><dd data-md=\"\">\n      <p><var>clipboard-part</var>, the clipboard part to process</p>\n     </dd><dd data-md=\"\">\n      <p><var>clipboard-event-data</var>, the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransfer\" id=\"ref-for-datatransfer①③\">DataTransfer</a></code> object for this event</p>\n     </dd><dt data-md=\"\">Output\n     </dt><dd data-md=\"\">\n      <p>None</p>\n    </dd></dl>",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>new-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitem\" id=\"ref-for-datatransferitem③\">DataTransferItem</a></code> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-kind\" id=\"ref-for-drag-data-item-kind③\">drag data item kind</a> set to <em>Plain Unicode string</em>, <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string④\">drag data item type string</a> set to <em>text/html</em> or <em>application/xhtml+xml</em> accordingly.</p>"
        },
        {
          "html": "<p>Extract the markup from <var>clipboard-part</var> and use the relevant parser to\nconstruct a DOM tree.</p>"
        },
        {
          "html": "<p>If the markup’s source URL is known, then resolve all relative URLs in\nHREF and SRC attributes using the source URL as base URL, and set the\nrespective attributes to the resolved absolute URL.</p>"
        },
        {
          "html": "If the markup’s origin is from a local application, then check whether\nthere are references to local files and/or other parts of the OS\nclipboard’s contents. If such references are found, references to\nsub-parts <em>must</em> be replaced by content-id references using the\ncid: URL scheme <a data-link-type=\"biblio\" href=\"https://www.w3.org/TR/clipboard-apis/#biblio-rfc2392\" title=\"Content-ID and Message-ID Uniform Resource Locators\">[RFC2392]</a>. To do so, process each attribute\nreferencing a local file or clipboard part according to the following\nsteps:",
          "rationale": "if",
          "steps": [
            {
              "html": "If <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items⑧\">items</a></code> already\ncontains an entry for the referenced file or clipboard part, then",
              "rationale": "set",
              "steps": [
                {
                  "html": "<p>Set <var>itemNumber</var> to the index of the existing\nentry.</p>"
                }
              ]
            },
            {
              "html": "Else,",
              "rationale": "let",
              "steps": [
                {
                  "html": "<p>Let <var>new-file-data</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitem\" id=\"ref-for-datatransferitem④\">DataTransferItem</a></code> with <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-kind\" id=\"ref-for-drag-data-item-kind④\">drag data item kind</a> set to \"file\", and <a data-link-type=\"dfn\" href=\"https://html.spec.whatwg.org/multipage/interaction.html#drag-data-item-type-string\" id=\"ref-for-drag-data-item-type-string⑤\">drag data item type string</a> set to the MIME type of\nthe file or clipboard part if known, or <code>application/octet-stream</code> if the\nfile’s type is unknown.</p>"
                },
                {
                  "html": "<p>Let <var>file-info</var> be a new <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-file\" id=\"ref-for-dfn-file\">File</a></code> object with <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-name\" id=\"ref-for-dfn-name\">name</a></code> set to the name part of the HTML attribute contents,\nand <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-lastModified\" id=\"ref-for-dfn-lastModified\">lastModified</a></code> set to the\ntimestamp of the referenced file or 0 if the entry\nreferences a clipboard part.</p>"
                },
                {
                  "html": "<p>Set <var>new-file-data</var>’s internal <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://www.w3.org/TR/FileAPI/#dfn-file\" id=\"ref-for-dfn-file①\">File</a></code> object to <var>file-info</var>.</p>"
                },
                {
                  "html": "<p>Add <var>new-file-data</var> to <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items⑨\">items</a></code> and let <var>itemNumber</var> be the index of this entry in the <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#datatransferitemlist\" id=\"ref-for-datatransferitemlist⑦\">DataTransferItemList</a></code>.</p>"
                }
              ]
            },
            {
              "html": "<p>Update the DOM attribute that referenced the local file or\nclipboard part to contain the string 'cid:' followed by <var>itemNumber</var>.</p>"
            }
          ]
        },
        {
          "html": "<p>Serialize the processed DOM and update <var>new-data</var> with the resulting\nHTML code.</p>"
        },
        {
          "html": "<p>Add <var>new-data</var> to <var>clipboard-event-data</var>’s <code class=\"idl\"><a data-link-type=\"idl\" href=\"https://html.spec.whatwg.org/multipage/dnd.html#dom-datatransfer-items\" id=\"ref-for-dom-datatransfer-items①⓪\">items</a></code>.</p>"
        }
      ]
    }
  ]
}